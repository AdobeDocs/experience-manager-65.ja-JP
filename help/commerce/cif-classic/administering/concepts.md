---
title: 概念
description: e コマースとAdobe Experience Managerの一般的な概念について説明します。
contentOwner: Guillaume Carlino
exl-id: 290b2af6-257f-42f2-b809-1248227a4795
source-git-commit: eaffc71c23c18d26ec5cbb2bbb7524790c4826fe
workflow-type: tm+mt
source-wordcount: '4480'
ht-degree: 30%

---

# 概念 {#concepts}

統合フレームワークは、次のためのメカニズムとコンポーネントを提供します。

* e コマースエンジンへの接続
* Adobe Experience Manager(AEM) へのデータの取り込み
* そのデータの表示と買い物客の回答の収集
* トランザクションの詳細を返す
* 両方のシステムからのデータを検索する

つまり、

* 買い物客は、待たずに登録や買い物をすることができます。
* 価格の変更は、買い物客に遅滞なく表示されます。
* 必要に応じて製品を追加できます。

>[!NOTE]
>
>e コマースフレームワークは、次の場合に使用できます。
>
>* [Adobe Commerce](/help/commerce/cif/integrating/magento.md)
>* [SAP Commerce Cloud](/help/commerce/cif-classic/administering/sap-commerce-cloud.md)
>* [Salesforce Commerce Cloud](https://github.com/adobe/commerce-salesforce)
>

>[!CAUTION]
>
>[e コマース統合フレームワーク](https://business.adobe.com/products/experience-manager/sites/ecommerce-integrations.html)は AEM アドオンです。
>
>セールス担当者は、適切なエンジンに従って、詳細を提供できます。

>[!CAUTION]
>
>このフレームワークは、独自プロジェクトの基本要件となります。
>
>フレームワークを実際の仕様に適合させるには、ある程度の開発作業が必要です。

>[!CAUTION]
>
>標準の AEM インストールには、汎用 AEM（JCR）e コマース実装が含まれています。
>
>これは、デモ目的、または要件に応じたカスタム実装の基本的な基盤として使用することを目的としています。

AEMと e コマースエンジンは、操作を最適化するために、それぞれの専門分野に専念します。 情報は、次のように、2 つの間でリアルタイムに転送されます。

* AEMが実行できる内容：

   * リクエスト:

      * e コマースエンジンからの製品情報。

   * 以下を指定します。

      * 製品情報、買い物かご、チェックアウトに関するユーザービュー。
      * e コマースエンジンへの買い物かごおよびチェックアウト情報。
      * 検索エンジン最適化 (SEO)。
      * コミュニティ機能。
      * 非構造化マーケティングインタラクション。

* e コマースエンジンがすること：

   * 以下を指定します。

      * データベースからの製品情報。
      * 製品バリアント管理。
      * Order Management。
      * ERP（Enterprise Resource Planning）。
      * 製品情報内を検索します。

   * プロセス:

      * 買い物かご。
      * チェックアウト。
      * 注文の達成。

>[!NOTE]
>
>正確な詳細は、e コマースエンジンとプロジェクトの実装によって異なります。

統合レイヤーを使用するための、標準搭載のAEMコンポーネントがいくつか用意されています。 現在、これらには次が含まれます。

* 製品情報
* 買い物かご
* チェックアウト
* マイアカウント

様々な検索オプションも使用できます。

## アーキテクチャ {#architecture}

統合フレームワークは、API、機能を説明する様々なコンポーネント、接続方法の例を提供するいくつかの拡張を提供します。

![chlimage_1-4](/help/sites-administering/assets/chlimage_1-4.png)

フレームワークを使用して、以下のような機能にアクセスできます。

![chlimage_1-5](/help/sites-administering/assets/chlimage_1-5.png)

### 実装 {#implementations}

AEM e コマースは e コマースエンジンを使用して実装されます。

* e コマース統合フレームワークは、e コマースエンジンをAEMと簡単に統合できるように設計されています。 専用の e コマースエンジンは、商品データ、買い物かご、チェックアウトおよび注文の達成を制御し、AEMはデータの表示とマーケティングキャンペーンを制御します。


>[!NOTE]
>
>標準の AEM インストールには、汎用 AEM（JCR）e コマース実装が含まれています。
>
>これは、デモ目的、または要件に応じたカスタム実装の基本的な基盤として使用することを目的としています。
>
>AEM e コマースは、AEM内で JCR に基づく汎用開発を使用して実装されます。
>
>* API の使用例を示す、スタンドアロンのAEMネイティブ e コマースの例です。 これは、既存のデータの表示およびマーケティングキャンペーンで、製品データ、買い物かご、チェックアウトを制御するために使用できます。 この場合、製品データベースは、AEM(Adobeによる [JCR](https://developer.adobe.com/experience-manager/reference-materials/spec/jcr/2.0/index.html)) をクリックします。
>
>  標準のAEMインストールには、 [汎用 e コマース実装](/help/commerce/cif-classic/administering/generic.md).

### コマースプロバイダー {#commerce-providers}

コマースエンジンからAEM e コマースサイトにデータをインポートする場合、コマースプロバイダーを使用してインポーターにデータを提供します。 1 つのコマースプロバイダーが複数のインポーターをサポートできます。

コマースプロバイダーは、次のいずれかに合わせてカスタマイズされたAEMコードです。

* バックエンドコマースエンジンへのインターフェイス
* JCR リポジトリ上にコマースシステムを実装する

AEMでは、現在、2 つのサンプルのコマースプロバイダーを利用できます。

* geometrixx-hybris 用のもの
* geometrixx-generic (JCR) の別の

通常、プロジェクトは、PIM および製品データスキーマに固有の、カスタマイズされた独自のコマースプロバイダーを開発する必要があります。

>[!NOTE]
>
>Geometrixxインポーターは CSV ファイルを使用します。実装の上にあるコメントに、受け入れられるスキーマの説明（カスタムプロパティも使用可能）が記載されています。

[ProductServicesManager](https://developer.adobe.com/experience-manager/reference-materials/6-5/javadoc/com/adobe/cq/commerce/pim/api/ProductServicesManager.html) は、（[OSGi](/help/sites-deploying/configuring.md#osgi-configuration-settings) を通じて）[ProductImporter](https://developer.adobe.com/experience-manager/reference-materials/6-5/javadoc/com/adobe/cq/commerce/pim/api/ProductImporter.html) インターフェイスと [CatalogBlueprintImporter](https://developer.adobe.com/experience-manager/reference-materials/6-5/javadoc/com/adobe/cq/commerce/pim/api/CatalogBlueprintImporter.html) インターフェイスの実装のリストを保守します。これらの実装は、インポーターウィザードの「**インポーター／コマースプロバイダー**」ドロップダウンフィールドに、`commerceProvider` プロパティを名前に使用して一覧表示されます。

ドロップダウンの特定のインポーター／コマースプロバイダーを利用できる場合は、必要な追加データがあれば（インポータータイプに応じて）次のどちらかに定義する必要があります。

* `/apps/commerce/gui/content/catalogs/importblueprintswizard/importers`
* `/apps/commerce/gui/content/products/importproductswizard/importers`

該当する `importers` フォルダーの下のフォルダーは、インポーター名と一致している必要があります。次に例を示します。

* `.../importproductswizard/importers/geometrixx/.content.xml`

読み込み元ファイルの形式は、インポーターによって定義されます。または、インポーターがコマースエンジンへの接続（WebDAV や http など）を確立する場合もあります。

## ロール {#roles}

統合システムでは、データを維持する次の役割を果たします。

* 次のものを保守する商品情報管理（PIM）ユーザー

   * 製品情報。
   * 分類、分類、承認。
   * デジタルアセット管理とやり取りする
   * 価格 — 多くの場合、これは ERP システムから取得され、コマースシステムで明示的に管理されていません。

* 以下を管理する作成者/マーケティングマネージャー

   * すべてのチャネルのマーケティングコンテンツ。
   * プロモーション
   * 割引券
   * キャンペーン.

* サーファー/買い物客：

   * 製品情報を表示します。
   * 品目を買い物かごに配置します。
   * 注文をチェックアウトします。
   * 注文の達成を期待します。

実際の場所は、汎用や e コマースエンジンなど、実装によって異なる場合があります。

![chlimage_1-6](/help/sites-administering/assets/chlimage_1-6.png)

## 製品 {#products}

### 製品データとマーケティングデータ {#product-data-versus-marketing-data}

#### 構造カテゴリとマーケティングカテゴリ {#structural-versus-marketing-categories}

次の 2 つのカテゴリを区別できる場合、意味のある構造（のツリー）で URL を明確にできます。 `cq:Page` ノード ) の場合と同様に、従って、従来のAEMコンテンツ管理に非常に近いものです。

* *構造的*カテゴリ

   *製品の概要*&#x200B;を定義するカテゴリツリー。例を以下に示します。

  `/products/mens/shoes/sneakers`

* *マーケティング*&#x200B;カテゴリ

  その他すべてのカテゴリ ( *製品は*&#x200B;例：

  `/special-offers/christmas/shoes`）

### 製品データ {#product-data}

製品を表示および管理するには、製品に関する様々な情報を保持する必要があります。

製品データは、次のいずれかになります。

* AEM（汎用）に直接保持できます。
* e コマースエンジンに保持して、AEM で利用できます。

  データタイプに応じて、 [同期済み](#catalog-maintenance-data-synchronization) 必要に応じて、または直接アクセスします。例えば、製品価格などの非常に揮発性で重要なデータは、常に最新の状態に保つために、各ページリクエストで e コマースエンジンから取得されます。

どちらの場合も、製品データがAEMに入力または読み込まれると、 **製品** コンソール。 ここでは、製品のカードおよびリスト表示に、次のような情報が表示されます。

* 画像
* SKU コード
* 最終変更日時

![chlimage_1-7](/help/sites-administering/assets/chlimage_1-7.png)

### 製品バリアント {#product-variants}

適切な製品については、バリアントに関する情報も保持できます。 例えば、衣料品の場合は、販売されている様々なカラーをバリアントとして保持します。

![ecommerceproductvariants](/help/sites-administering/assets/ecommerceproductvariants.png)

### 製品属性 {#product-attributes}

各製品に関して保持される個々の属性は、使用する e コマースエンジンとAEMの実装によって異なる場合があります。 製品ページの表示や製品情報の編集を行う際に、必要に応じてこれらの情報を使用できます。次の情報が含まれます。

* **画像**

  商品の画像。

* **タイトル**

  商品名。

* **説明**

  テキストによる商品の説明。

* **タグ**

  関連商品のグループ化に使用するタグ。

* **デフォルトのアセットカテゴリ**

  アセットのデフォルトカテゴリです。

* **ERP データ**

  エンタープライズリソースプランニング（ERP）に関する情報。

   * **SKU**

     在庫管理単位（SKU）に関する情報。

   * **カラー**
   * **サイズ**
   * **価格**

     商品の単価。

* **概要**

  商品の特長の概要。

* **機能**

  商品の特長の詳細。

### 製品アセット {#product-assets}

個々の製品に対して、選択したアセットを保持できます。 一般的には、画像とビデオが含まれます。

## カタログ {#catalogs}

カタログは、管理と買い物客への表示の両方を容易にするために、製品データをまとめてグループ化します。 多くの場合、カタログは言語、地理的地域、ブランド、季節、趣味、スポーツなどの属性に従って構造化されます。

### カタログ構造 {#catalog-structure}

#### 複数言語のカタログ {#catalogs-in-multiple-languages}

AEMは、複数の言語での製品コンテンツをサポートします。 データを要求すると、統合フレームワークが現在のツリーからその言語を取得します（`/content/geometrixx-outdoors/en_US` の配下のページの場合は `en_US` など）。

多言語ストアの場合、各言語ツリーのカタログを個別に読み込む ( または [MSM](/help/sites-administering/msm.md)) をクリックします。

#### 複数のブランドのカタログ {#catalogs-for-multiple-brands}

言語と同様に、大規模な多国籍企業は複数のブランドに対応する必要があります。

#### タグ別のカタログ {#catalogs-by-tags}

また、タグを使用して、製品を 1 つのカタログにグループ化することもできます。 タグは、季節的なオファーなど、より動的なカタログに使用できます。

### カタログの設定（初期読み込み） {#catalog-setup-initial-import}

実装に応じて、基本カタログに必要な製品データを、次の場所からAEMに読み込むことができます。

* CSV ファイル（汎用実装用）
* e コマースエンジン

### カタログのメンテナンス（データの同期） {#catalog-maintenance-data-synchronization}

製品データに対するその他の変更は避けられません。

* 汎用実装の場合、これらは [製品エディター](/help/commerce/cif-classic/administering/generic.md#editing-product-information)
* [e コマースエンジンを使用している場合は、変更を同期する必要があります。](#data-synchronization-with-an-ecommerce-engine-ongoing)

#### e コマースエンジンとのデータ同期（継続中） {#data-synchronization-with-an-ecommerce-engine-ongoing}

最初の読み込みの後は、製品データの変更は避けられません。

e コマースエンジンを使用する場合、製品データはそこに保持され、AEMで使用できる必要があります。 この製品データは、更新がおこなわれる際に同期する必要があります。

同期は、データのタイプによって異なります。

* [変更内容のデータフィードとともに、定期的同期を使用します](/help/commerce/cif-classic/developing/sap-commerce-cloud.md#product-synchronization-and-publishing)。

  これに加え、特定の更新を選択して高速更新をおこなうことができます。

* 価格情報などの非常に揮発性の高いデータは、常に最新の状態に保つために、ページリクエストごとにコマースエンジンから取得されます。

### カタログ — パフォーマンスと拡張 {#catalogs-performance-and-scaling}

大量の製品（100,000 を超える）を含む大規模なカタログを e コマースエンジン (PIM) から読み込むと、ノード数が多いため、システムに影響を与える可能性があります。 また、製品に関連アセット（製品画像など）がある場合は、オーサリングインスタンスの速度が低下する可能性があります。 これは、これらのアセットの後処理が CPU とメモリを集中的に消費するからです。

これらの問題を回避する方法は様々です。

* [バケッティング](#bucketing) - 多数のノードに対応する
* [アセットの後処理を専用インスタンスにオフロードする](#offload-asset-post-processing-to-a-dedicated-instance)
* [商品データのみを読み込む](#only-import-product-data)
* [読み込みのスロットリングとバッチ保存](#import-throttling-and-batch-saves)
* [パフォーマンステスト](#performance-testing)
* [パフォーマンス - その他](#performance-miscellaneous)

#### グループ化 {#bucketing}

JCR ノードに多数の直接子ノード（例えば、1000 以上）がある場合、パフォーマンスに影響を与えないようにするには、バケット（仮想フォルダー）が必要です。 これらは、インポート時にアルゴリズムに従って生成されます。

これらのバケットは、カタログ構造に導入される疑似フォルダーの形式を取りますが、パブリック URL では見えないように設定できます。

#### アセットの後処理を専用インスタンスにオフロードする {#offload-asset-post-processing-to-a-dedicated-instance}

このシナリオでは、2 つのオーサーインスタンスを設定します。

1. プライマリオーサーインスタンス

   PIM から商品データをインポートします。PIM ではアセットパスの後処理は無効になっています。

1. 専用の DAM オーサーインスタンス

   PIM から商品アセットをインポートして後処理を実行したあと、プライマリオーサーインスタンスで使用できるように商品アセットをレプリケートします。

![アーキテクチャ図](/help/sites-administering/assets/chlimage_1-8.png)

#### 商品データのみを読み込む {#only-import-product-data}

読み込むアセット（画像）が製品に含まれていない場合は、アセットの後処理の影響を受けずに、製品データを読み込むことができます。

![アーキテクチャ図](/help/sites-administering/assets/chlimage_1-9.png)

#### パフォーマンステスト {#performance-testing}

AEM e コマースの実装では、パフォーマンステストを考慮する必要があります。

* オーサー環境：

  背景（例えば、読み込み）アクティビティは、通常のユーザーアクティビティ（ページ編集など）と同時に発生し、フロントエンドパフォーマンスがより優先度が高い場合でも、オンライン作成者が見た不満によって、運用開始決定をブロックする可能性があります。

* パブリッシュ環境：

  レプリケーションは、コンテンツが迅速かつ確実に公開されるようにする重要なプロセスです。レプリケーションは、公開するコンテンツをオーサーがどのようにグループ化するかによって影響を受ける場合があります。

* フロントエンド:

  フロントエンドの無効化とキャッシュの無効化が混在すると、予期せぬパフォーマンスの低下につながる可能性があります。テストは、これらを回避するのに役立ちます。

このパフォーマンステストでは、ターゲットに関する知識と分析が必要です。

* コンテンツのボリューム

   * Assets
   * ローカライズされた I18 製品および SKU

* ユーザーアクティビティ：

   * 一括編集
   * 一括公開
   * 強力な検索リクエスト

* バックグラウンドプロセス

   * 読み込み
   * 同期の更新（価格など）

* メンテナンス要件（バックアップ、Tar PM の最適化、データストアのガベージコレクションなど）

#### パフォーマンス - その他 {#performance-miscellaneous}

すべての実装について、次の点に留意してください。

* 製品、在庫管理の単位やカテゴリは多数ある場合があるので、コンテンツのモデル化に使用できる最少数のノードを使用するようにしてください。

  ノード数が多いほど、コンテンツの柔軟性が高まります（parsys など）。 しかし、すべてはトレードオフであり、30,000 個の製品を操作する場合（例：デフォルト）には個々の柔軟性が必要ですか。

* 複製をできるだけ避ける（ローカライゼーションを参照）か、または可能な場合は複製が生じるノード数を考慮します。
* クエリの最適化を準備するために、できる限りコンテンツにタグを付けるようにします。

  次に例を示します。

  `/content/products/france/fr/shoe/reebok/pump/46 SKU`

  には、コンテンツレベルごとに 1 つのタグ（例：国、言語、カテゴリ、ブランド、製品）が必要です。 検索

  `//element(*,my:Sku)[@country='france' and @language='fr'`

  および

  `@category='shoe' and @brand='reebok' and @product='pump']`

  以下を検索するよりも大幅に速くなります

  `/jcr:root/content/france/fr/shoe/reebok/pump/element(*,my:Sku)`

* 技術スタックで、コンテンツアクセスモデルとサービスを組み込んだプランを立てます。 これは一般的なベストプラクティスですが、最適化フェーズでは、頻繁に読み取られるデータのアプリケーションキャッシュを追加する（およびバンドルキャッシュにを埋め込まない）ので、ここではさらに重要です。

  例えば、属性管理は、製品の読み込みによって更新されるデータに関係するので、キャッシュの適切な候補となることがよくあります。
* の使用を検討します。 [プロキシページ](#proxy-pages).

### カタログセクションページ {#catalog-section-pages}

カタログセクションには、次のような情報が表示されます。

* カテゴリの紹介（画像やテキスト）。特別オファーを宣伝するバナーやティーザーにも使用できます。
* そのカテゴリの個々の製品へのリンク
* 他のカテゴリへのリンク

![ecommerce_categoryrunning](/help/sites-administering/assets/ecommerce_categoryrunning.png)

### 製品ページ {#product-pages}

製品ページには、個々の製品に関する包括的な情報が記載されています。 また、e コマースエンジンに登録されている価格の変更など、からの動的な更新も反映されます。

製品ページは、 **製品** コンポーネント（例えば、内） **コマース製品** テンプレート：

![ecommerce_nairobirunnersgreen](/help/sites-administering/assets/ecommerce_nairobirunnersgreen.png)

製品コンポーネントには、次のものが表示されます。

* テキストや画像を含む、一般的な商品情報。
* 価格。ページが表示/更新されるたびに e コマースエンジンから取得されます。
* カラーやサイズなどの製品バリアント情報。

買い物客は、アイテムを買い物かごに追加する際に、この情報を使用して以下を選択できます。

* 色とサイズのバリエーション
* 数量

#### 製品ランディングページ {#product-landing-pages}

主に静的な情報を提供するAEMページです。例えば、基になる製品ページへのリンクを含んだ紹介や概要などです。

### 商品コンポーネント {#product-component}

The **製品** コンポーネントは、必要なメタデータ ( つまり、 `cartPage` および `cartObject`) をクリックします。 これは、デモサイト Geometrixx Outdoors では `UserInfo.jsp` によって提供されています。

The **製品** 個々の要件に応じて、コンポーネントをカスタマイズすることもできます。

### プロキシページ {#proxy-pages}

プロキシページは、リポジトリの構造を簡素化し、大きなカタログのストレージを最適化するために使用します。

カタログを作成すると、AEM内で更新およびカスタマイズできる各製品の個々のコンポーネントが提供されるので、製品ごとに 10 ノードが使用されます。 カタログに数百、数千の製品が含まれている場合、この大量のノードが問題になる可能性があります。 問題を回避するには、プロキシページを使用してカタログを作成します。

プロキシページでは、実際の商品コンテンツをまったく含まない 2 ノード構造（`cq:Page` と `jcr:content`）を使用しています。コンテンツは、要求時に商品データとテンプレートページを参照することで生成されます。

しかし、トレードオフがあります。 AEM内で製品情報をカスタマイズすることはできません。（お客様のサイト用に定義された）標準テンプレートが使用されます。

>[!NOTE]
>
>プロキシページのない大きなカタログを読み込んだ場合、問題は発生しません。
>
>いつでも方法を変換できます。 カタログのサブセクションを変換することもできます。

## プロモーションと割引券 {#promotions-and-vouchers}

### 割引券 {#vouchers}

割引券とは、買い物客を誘致し、顧客の忠誠度に報いを与える割引を提供する試みとテストの方法です。

* 割引券の供給：

   * 割引券コード（買い物客が買い物かごに入力する）。
   * 割引券ラベル（買い物客が買い物かごに入力した後に表示される）。
   * プロモーションパス（割引券が適用されるアクションを定義します）。

* 外部のコマースエンジンで割引券を提供することもできます。

AEM で以下を行います。

* 割引券は、Web サイトコンソールを使用して作成／編集するページベースのコンポーネントです。
* **割引券**&#x200B;コンポーネントは、次のものを提供します。

   * 割引券管理用のレンダラー。買い物かごに現在入っている割引券があれば表示します。
   * 割引券を管理（追加/削除）するための編集ダイアログ（フォーム）。
   * 買い物かごへの割引券の追加/削除に必要なアクション。

* 割引券には、独自の開始日時や終了日時は設定されておらず、親キャンペーンの開始日時や終了日時を使用します。

>[!NOTE]
>
>AEM では&#x200B;**割引券**&#x200B;という用語を使用します。これは、**クーポン**&#x200B;という用語と同義です。

### プロモーション {#promotions}

プロモーションは、割引券と共に、次のようなシナリオを実現できます。

* 企業は従業員向けのカスタム価格を提供しています。従業員は手作りのユーザーリストです。
* 長期の顧客は、すべての注文に対して割引を受けます。
* 明確に定義された期間に提供される販売価格。
* 顧客は、前の注文が特定の金額を超えた場合に割引券を受け取ります。
* *商品 X* を購入した顧客が&#x200B;*商品 Y*（ペア商品）に対する割引をオファーされる。

プロモーションは、製品情報マネージャーではなく、マーケティングマネージャーでは管理されます。

* プロモーションは、Web サイトコンソールを使用して作成／編集されるページベースのコンポーネントです。``
* プロモーションの提供：

   * 優先度
   * プロモーションハンドラーのパス

* プロモーションをキャンペーンに関連付けて、オン/オフの日時を定義できます。
* プロモーションをエクスペリエンスに関連付けて、セグメントを定義できます。
* エクスペリエンスに接続されていないプロモーションは、単独では実行されませんが、割引券で実行することはできます。
* プロモーションコンポーネントには、次が含まれます。

   * プロモーション管理用のレンダラーとダイアログ
   * プロモーションハンドラー固有の設定パラメーターをレンダリングおよび編集するためのサブコンポーネント

AEMでは、プロモーションも [Campaign Management](/help/sites-authoring/personalization.md):

* a [campaign](/help/sites-authoring/personalization.md) オン/オフ時間を指定します。
* [エクスペリエンス](/help/sites-authoring/personalization.md) *範囲* キャンペーンは、アセット（ティーザーページ、プロモーションなど）を、対応するオーディエンスセグメントに従ってグループ化するために使用します

プロモーションは、エクスペリエンス内または直接キャンペーン内に保持できます。

* プロモーションがエクスペリエンス内に保持されている場合、そのプロモーションをオーディエンスセグメントに自動的に適用できます。

  例えば、geometrixx-outdoors サンプルサイトでは、次のプロモーションが実施されます。

  `/content/campaigns/geometrixx-outdoors/big-spender/ordervalueover100/free-shipping`

  がエクスペリエンス内にあるので、セグメント（`ordervalueover100`）が解決されるたびに自動的に起動されます。

* エクスペリエンス内に存在しない（キャンペーン内にのみ存在する）プロモーションの場合は、自動的にはオーディエンスに適用されません。ただし、買い物客が割引券を買い物かごに入力し、その割引券がプロモーションを参照している場合には、プロモーションが呼び出されます。

  例えば、次のプロモーションでは、

  `/content/campaigns/geometrixx-outdoors/article/10-bucks-off`

  がエクスペリエンス外にあるので、自動的には実行されません（つまり、セグメント化に基づく）。 ただし、このプロモーションを参照する割引券が、記事のキャンペーンに含まれるいくつかのエクスペリエンスにあります。これらの割引券コードを買い物かごに入力すると、プロモーションが実行されます。

>[!NOTE]
>
>[hybris プロモーション](https://www.hybris.com/modules/promotion) および [hybris 割引券](https://www.hybris.com/ja/modules/voucher) 買い物かごに影響を与え、価格に関連するものをすべてカバーします。 プロモーション固有のマーケティングコンテンツ（バナーなど） は hybris 昇格には含まれていません。

## パーソナライズ機能 {#personalization}

### 顧客登録とアカウント {#customer-registration-and-accounts}

買い物客が登録する際は、AEMと e コマースエンジンの間でアカウントの詳細を同期する必要があります。 機密データは個別に保持されますが、プロファイルは共有されます。

![chlimage_1-10](/help/sites-administering/assets/chlimage_1-10.png)

正確なメカニズムは、シナリオによって異なることがあります。

1. ユーザーアカウントは両方のシステムに存在します。

   1. アクションは不要です。

1. ユーザーアカウントはAEMにのみ存在します：

   1. ユーザーは、同じアカウント ID とランダムパスワードを使用して e コマースエンジンで作成され、AEMに保存されます。
   1. 最初の呼び出し時（例えば、製品ページがリクエストされ、e コマースエンジンが価格で参照される場合）にAEMが e コマースエンジンにログインしようとするので、ランダムなパスワードが必要です。 これはAEMのログイン後に発生するので、パスワードは使用できません。

1. ユーザーアカウントは e コマースエンジンにのみ存在します：

   1. アカウントは、AEMで、同じアカウント ID とパスワードで作成されます。

e コマースエンジンを使用する場合、AEMはアカウント ID とパスワード（オプションでユーザーグループ）のみを保存します。 その他すべての情報は、e コマースエンジンに保存されます。

>[!NOTE]
>
>e コマースエンジンを使用する場合は、AEMインスタンスにログインするユーザー用に作成されたアカウントが、そのエンジンと通信する他のAEMインスタンスに（ワークフローを介して）レプリケートされるようにする必要があります。
>
>そうしないと、他のAEMインスタンスもエンジン内の同じユーザーのアカウントを作成しようとします。 これらのアクションは、 `DuplicateUidException` エンジンから来て

### 顧客の新規登録 {#customer-sign-up}

買い物客が買い物かごにアクセスできるようにするには、多くの場合、サインアップが必要です。 サインアップするには、顧客固有のアカウントを作成できるよう、登録（アカウントの作成）が必要です。

![chlimage_1-11](/help/sites-administering/assets/chlimage_1-11.png)

>[!NOTE]
>
>匿名の買い物かごとチェックアウトもサポートされます。

### 顧客のサインイン {#customer-sign-in}

サインアップ後、買い物客はアカウントでログインし、行動を追跡し、注文を満たすことができます。

![chlimage_1-12](/help/sites-administering/assets/chlimage_1-12.png)

### シングルサインオン {#single-sign-on}

シングルサインオン (SSO) が提供されるので、作成者はAEMと e コマースシステムの両方で、2 回ログインしなくてもわかります。

### myAccount {#myaccount}

e コマースエンジンからのトランザクションデータは、買い物客に関する個人情報と組み合わされます。 AEMでは、このデータの一部をプロファイルデータとして使用します。 AEMでのフォームのアクションにより、情報が e コマースエンジンに書き戻されます。

アカウント情報を簡単に管理できるページが用意されています。 このリンクには、 **マイアカウント** Geometrixxページの上部に表示されるか、 `/content/geometrixx-outdoors/en/user/account.html`.

![chlimage_1-13](/help/sites-administering/assets/chlimage_1-13.png)

### アドレス帳 {#address-book}

配信、請求、代替アドレスなど、様々なアドレスをサイトに保存する必要があります。 これは、デフォルトのアドレス形式に基づくフォームを使用して実装するか、AEMが提供するアドレス帳コンポーネントを使用して実装できます。

このアドレス帳コンポーネントでは、次の操作を実行できます。

* ブック内のアドレスの編集
* 配送先住所の住所を本から選択する
* 請求先住所の住所を書籍から選択

デフォルトとして希望するアドレスを選択できます。

アドレス帳コンポーネントにアクセスするには、**マイアカウント**&#x200B;ページから「**アドレス帳**」をクリックするか、`/content/geometrixx-outdoors/en/user/account/address-book.html` に移動します。

![chlimage_1-14](/help/sites-administering/assets/chlimage_1-14.png)

次をクリックできます。 **新しいアドレスを追加…** アドレス帳にアドレスを追加する場合。 フォームが開きます。このフォームに入力して、「 **アドレスを追加**.

>[!NOTE]
>
>アドレス帳に複数のアドレスを入力できます。

アドレス帳は、買い物かごを「チェックアウト」する際に使用されます。

![chlimage_1-15](/help/sites-administering/assets/chlimage_1-15.png)

アドレスは、`user_home/profile/addresses` の下に保持されます。
例えば、Alison Parker の場合は、/home/users/geometrixx/aparker@geometrixx.info/profile/addresses の下です。

デフォルトとするアドレスを選択できます。この情報は、アドレスと一緒にではなく、買い物客のプロファイルに保持されます。プロファイルのプロパティ `address.default` の値が、選択されたアドレスのパスに設定されます。

### お客様固有の価格 {#customer-specific-pricing}

e コマースエンジンは、コンテキスト（基本的には買い物客情報）を使用して保有している価格を判断し、正しい情報をAEMに返します。

## 買い物かごと注文 {#shopping-cart-and-orders}

買い物をする際に、買い物客は商品ページを閲覧し、品目を選択して買い物かごに入れます。 チェックアウトに進むと、注文をおこなうことができます。

### 匿名の買い物客 {#anonymous-shoppers}

匿名の顧客は、次のことが可能です。

* 製品を表示
* 買い物かごに製品を追加する
* チェックアウトを実行して注文をおこなう

>[!NOTE]
>
>インスタンスの住所情報の設定、または顧客登録に応じて、チェックアウトの前に必要になる場合があります。

### 登録された買い物客 {#registered-shoppers}

登録済みの顧客は、次のことが可能です。

* アカウントにログイン
* 製品を表示
* 買い物かごに製品を追加する
* チェックアウトを実行して注文をおこなう
* 以前の注文の表示と追跡

### 買い物かごの内容の概要 {#shopping-cart-content-overview}

買い物かごには次の情報が表示されます。

* 選択した項目の概要
* 選択されたアイテムの商品ページへのリンク
* 次の機能を備えている。

   * 個々の項目の数/数量を更新
   * 個々の項目を削除

![ecommerce_shoppingcart](/help/sites-administering/assets/ecommerce_shoppingcart.png)

買い物かごは、使用しているエンジンに応じて次のように保存されます。

* AEM の汎用エンジンは、買い物かごを cookie に保存します。
* 特定の e コマースエンジンは、セッションで買い物かごを保存できます。

どちらの場合も、項目はログイン/ログアウト（同じマシン/ブラウザー上でのみ）をまたいで買い物かごに残ります（また、復元することもできます）。 次に例を示します。

* `anonymous` として閲覧し、商品を買い物かごに追加する
* 次としてサインイン `Allison Parker` - Allison&#39;s cart is empty
* 製品を Allison の買い物かごに追加
* ログアウト — 買い物かごに `anonymous`

* 再度次の名前でサインイン `Allison Parker` - Allison の製品は復元されました。

>[!NOTE]
>
>anonymous の買い物かごは、同じコンピューター／ブラウザー上でのみ復元できます。

>[!NOTE]
>
>を使用して買い物かごの内容の復元をテストすることはお勧めしません。 `admin` アカウントを使用する場合、 `admin` e コマースエンジンのアカウント（hybris など）。

>[!NOTE]
>
>hybris は、定義された期間の後に保留中の買い物かごを削除するように設定できます。

チェックアウト前に、価格の変更が（両方のシステムで）発生時に反映されます。

### 注文情報 {#order-information}

注文に関する実装情報に応じて、注文は e コマースエンジンまたはAEMに保持され、この情報はAEMによってレンダリングされます。

様々な情報が保存されます。次の情報が含まれます。

* **注文 ID**

  注文の参照番号。

* **注文日時**

  発注日。

* **ステータス**

  注文のステータス。例：発送済み

* **通貨**

  注文の通貨。

* **コンテンツ項目**

  並べ替えられた品目のリスト。

* **小計**

  注文された品目の合計金額。

* **税**

  注文に対して支払うすべての税金の金額。

* **送料**

  送料。

* **合計**

  注文の合計値（注文された品目、税金、送料）。

* **請求先住所**

  請求書を送付する住所。

* **支払いトークン**

  支払い方法。

* **支払いステータス**

  支払のステータス。

* **発送先住所**

  商品を発送する住所。

* **発送方法**

  発送の方法。例：陸路、海路または空路。

* **追跡番号**

  配送会社が使用する追跡番号。

* **追跡リンク**

  配送中に注文の追跡に使用するリンク。

>[!NOTE]
>
>順序を作成ウィザードで使用されるフィールドは、その場所に対して定義されたタッチ操作向け基礎モードがあるかどうかによって異なります。 一般的な例では、次の場所にあります。
>`/etc/scaffolding/geometrixx-outdoors/order/jcr:content/cq:dialog`

注文が AEM 内に保持されている場合、注文コンソールには注文ごとに次の内容が表示されます。

* 買い物かごの中のアイテム数
* 注文の合計金額
* 注文日時
* ステータス

![chlimage_1-16](/help/sites-administering/assets/chlimage_1-16.png)

### 注文の追跡 {#order-tracking}

注文後、買い物客は多くの場合次の場所に戻ります。

* 注文のステータスの確認
* 注文から製品を削除
* 注文に商品を追加

注文の配信を受け取った後、買い物客は、一定期間におこなわれた注文の履歴を表示したい場合もあります。

注文の達成と追跡は、e コマースエンジンによって管理されます。 注文履歴コンポーネントを使用して、AEM で情報を表示できます。このコンポーネントには、適用された割引券やプロモーションを含む、関連する詳細がすべて表示されます。次に例を示します。

![chlimage_1-17](/help/sites-administering/assets/chlimage_1-17.png)

## チェックアウト {#checkout}

チェックアウトは、標準のAEM forms で実装されます。 これにより、マーケティングマネージャーは、マーケティングコンテンツを使用してエクスペリエンスをカスタマイズできます。

次に、e コマースは、AEM forms からの入力を使用してチェックアウトプロセスを管理します。

### 支払いセキュリティ {#payment-security}

クレジットカード情報を含む支払いの詳細は、多くの場合、e コマースエンジンによって管理されます。 AEM は、そのようなトランザクション情報をエンジンに転送します（情報はエンジンから支払い処理サービスに転送されます）。

Payment Card Industry（PCI）コンプライアンスを実現できます。

### 注文の確認 {#confirmation-of-order}

注文は画面上で確認され、[注文の追跡](#order-tracking)によって追跡できます。

## 検索 {#search-features}

![chlimage_1-18](/help/sites-administering/assets/chlimage_1-18.png)

AEM は商品に標準のページを使用しているので、標準の検索コンポーネントを使用して検索ページを作成できます。

より詳細な実装が必要な場合は、次のいずれかを実行できます。

* 必要な機能でデフォルトの検索コンポーネントを拡張します。
* `CommerceService` に検索メソッドを実装し、検索ページで e コマース検索コンポーネントを使用する。

e コマースエンジンを使用している場合は、e コマースエンジンソリューションに e コマース検索 API を完全に実装できるので、標準で提供されている e コマース検索コンポーネントを使用できます。ファセット検索を使用すると、JCR やエンジンを検索できます。
