---
title: 監視フォルダーの作成または設定
description: 監視フォルダーの作成方法や削除方法、既存の監視フォルダーのプロパティの変更方法について説明します。
content-type: reference
products: SG_EXPERIENCEMANAGER/6.5/FORMS
topic-tags: publish
exl-id: b15d8d3b-5e47-4c33-95fe-440fcf96be83
solution: Experience Manager, Experience Manager Forms
role: Admin, User, Developer
source-git-commit: f6771bd1338a4e27a48c3efd39efe18e57cb98f9
workflow-type: tm+mt
source-wordcount: '1831'
ht-degree: 99%

---

# 監視フォルダーの作成または設定 {#create-or-configure-a-watched-folder}

管理者は、*監視フォルダー*&#x200B;と呼ばれるネットワークフォルダーを設定できます。ユーザーがファイル（PDF ファイルなど）を監視フォルダーに配置すると、設定済みの操作が開始され、ファイルが操作されます。指定の操作が実行されると、変更されたファイルが指定の出力フォルダーに保存されます。監視フォルダーの管理について詳しくは、[管理ヘルプ](/help/forms/using/admin-help/configuring-watched-folder-endpoints.md)を参照してください。

監視フォルダーのユーザーインターフェイスを使用して次の操作を実行できます。

* 監視フォルダーを作成
* 既存の監視フォルダーのプロパティを更新
* 監視フォルダーを削除

## 監視フォルダーを作成 {#create-a-watched-folder}

監視フォルダーを設定する前に、以下を確認します。

* 監視フォルダーは AEM Forms の高度な機能です。使用するには、AEM Forms アドオンパッケージが必要です。適切な AEM Forms アドオンパッケージがインストールおよび設定されている必要があります。
* 監視フォルダーは共有ストレージまたはローカルストレージに作成できます。 監視フォルダーを実行するように設定されている AEM Forms ユーザーは、監視フォルダーの読み取り権限と書き込み権限を持っている必要があります。
* サービス、ワークフロー、またはスクリプトを使用して、監視フォルダーの操作を自動化できます。対象のサービス、ワークフロー、またはスクリプトが作成されていて、実行可能な状態にある必要があります。サービス、ワークフロー、スクリプトについて詳しくは、「[さまざまなファイル処理方法](/help/forms/using/watched-folder-in-aem-forms.md#various-methods-for-processing-files)」を参照してください。
* 監視フォルダーの各種プロパティについて詳しくは、[監視フォルダーのプロパティ](watched-folder-in-aem-forms.md#watchedfolderproperties)を参照してください。

次の手順を実行して、監視フォルダーを作成します。

1. 画面の左上隅にある **Adobe Experience Manager** アイコンを選択します。
1. **ツール**／**Forms**／**監視フォルダーを設定を選択します。**&#x200B;既に設定されている監視フォルダーのリストが表示されます。
1. 「**新規**」を選択します。監視フォルダーを作成するために必要なフィールドのリストが表示されます。

   * **名前**：監視フォルダーを識別します。名前には英数字のみを使用します。
   * **パス**：監視フォルダーの場所を指定します。クラスター環境では、クラスターの異なるノード上で AEM を実行しているすべてのユーザーがアクセス可能な共有ネットワークフォルダーを、この設定に指定する必要があります。
   * **次を使用してファイルを処理**：開始するプロセスのタイプです。ワークフロー、スクリプト、またはサービスを指定できます。
   * **サービス名／スクリプトパス/ワークフローパス**：このフィールドの動作は、「**次を使用してファイルを処理**」フィールドに指定されている値に基づきます。次の値を指定できます。

      * ワークフローに関しては、実行するワークフローモデルを指定します（/etc/workflow/models/&lt;workflow_name>/jcr:content/model など）。
      * スクリプトに関しては、実行するスクリプトの JCR パスを指定します（/etc/watchfolder/test/testScript.ecma など）。
      * サービスに関しては、OSGi サービスの特定に使用するフィルターを指定します。サービスは com.adobe.aemfd.watchfolder.service.api.ContentProcessor インターフェイスの実装として登録されます。例えば、以下のコードはカスタムの foo=bar プロパティを持つ ContentProcessor インターフェイスのカスタム実装です。

   >[!NOTE]
   >
   >「**次を使用してファイルを処理**」フィールドで「**サービス**」を選択した場合、「サービス名（inputProcessorType）」フィールドの値は括弧で囲む必要があります。例えば、（foo=bar）のように指定します。

   ```java
   @Component(metatype = true, immediate = true, label = "WF Test Service", description = "WF Test Service")
   @Service(value = {OutputWriter.class, ContentProcessor.class})
   @Property(name = "foo", value = "bar")
   public class OutputWriter implements ContentProcessor {
   ```

   * **出力ファイルパターン**：出力ファイルおよび出力フォルダーの名前と場所を決めるために監視フォルダーで使用されるパターンのセミコロン（;）区切りのリストを指定します。ファイルパターンについて詳しくは、「[ファイルパターンについて](/help/forms/using/admin-help/configuring-watched-folder-endpoints.md#about-file-patterns)」を参照してください。

1. 「**詳細**」を選択します。「詳細」タブには、さらに多くのフィールドが含まれています。これらのほとんどのフィールドにはデフォルトの値が指定されています。

   * **ペイロードマッパーフィルター：**&#x200B;監視フォルダーを作成すると、監視対象のフォルダーの中にフォルダー構造が作成されます。フォルダー構造には stage、result、preserve、input、failure フォルダーが含まれます。このフォルダー構造はワークフローへの入力ペイロードとして使用され、ワークフローからの出力を受け取ります。また、失敗ポイントのリストも作成します（存在する場合）。ペイロードの構造は、監視フォルダーの構造とは異なります。監視フォルダーの構造をペイロードにマッピングするために、カスタムスクリプトを作成することができます。このようなスクリプトは、ペイロードマッパーフィルターと呼ばれます。2 つのすぐに使える構築済みのペイロードマッパーの実装が利用可能です。[カスタムのマッパー実装](/help/forms/using/watched-folder-in-aem-forms.md#creating-a-custom-payload-mapper-filter)がない場合は、用意されている 2 つのマッパー実装のいずれかを使用してください。

      * **デフォルトのマッパー：**&#x200B;デフォルトのペイロードマッパーを使用して、監視フォルダーの入力と出力の内容をペイロード内の別々の入出力フォルダーに保存します。
      * **単純なファイルベースのペイロードマッパー：**&#x200B;入力と出力の内容をペイロードフォルダーに直接保存するには、単純なファイルベースのペイロードマッパーを使用してください。デフォルトのマッパーのような追加の階層は作成されません。

   * **実行モード**：ワークフローを実行する際に許可される実行モードのカンマ区切りのリストを指定します。
   * **次の一定時間後にステージファイルをタイムアウト**：入力ファイルまたは入力フォルダーが処理を開始してから、タイムアウト処理に失敗したと判定されるまでの待機時間の秒数を指定します。タイムアウトはこのプロパティの値が正である場合にのみ有効になります。
   * **スロットルの実行時にタイムアウトしたステージファイルを削除**：有効にすると、「**次の一定時間後にステージファイルをタイムアウト**」は、監視フォルダーでスロットルが有効にされている場合にのみ有効になります。
   * **次の間隔で入力フォルダーをスキャン：**&#x200B;監視フォルダーをスキャンして入力を確認する間隔（秒単位）を指定します。スロットルの設定が有効になっていない限り、ポーリング間隔は平均的なジョブの処理時間より長くする必要があります。そうしないと、システムが過負荷になるおそれがあります。間隔の値には 1 以上を指定する必要があります。
   * **ファイルパターンを除外**：監視フォルダーがスキャンして取得するファイルとフォルダーを決定するために使用する、パターンのセミコロン（;）区切りのリストを指定します。指定したパターンに当てはまるファイルまたはフォルダーは、スキャンの対象外となります。ファイルパターンについて詳しくは、「[ファイルパターンについて](/help/forms/using/admin-help/configuring-watched-folder-endpoints.md#about-file-patterns)」を参照してください。
   * **ファイルパターンを含める**：スキャンおよび取得の対象とするファイルとフォルダーを決めるために監視フォルダーで使用されるパターンのセミコロン（;）区切りのリストを指定します。例えば、「ファイルパターンを含める」が「input&amp;ast;」の場合、名前が input&amp;ast; に一致するすべてのファイルおよびフォルダーが取得されます。デフォルト値は &amp;ast; です。すべてのファイルとフォルダーが対象となります。ファイルパターンについて詳しくは、「[ファイルパターンについて](/help/forms/using/admin-help/configuring-watched-folder-endpoints.md#about-file-patterns)」を参照してください。
   * **待機時間：**&#x200B;フォルダーまたはファイルの作成後にスキャンを実行するまでの待機時間（ミリ秒単位）を指定します。例えば、待機時間が 3,600,000 ミリ秒（1 時間）のときに、1 分前にファイルが作成されたとすると、59 分以上が経過した後でこのファイルが取得されます。デフォルト値は 0 です。

     この設定は、入力フォルダーにファイルまたはフォルダーのすべてのコンテンツがコピーされるようにする場合に役立ちます。例えば、処理の対象となるファイルサイズが大きく、そのファイルをダウンロードするのに 10 分かかる場合は、待機時間を 10 x 60 x 1000 ミリ秒に設定します。この間隔により、ファイルが作成されてから 10 分が経過していない場合は、監視フォルダーはそのファイルをスキャンしなくなります。

   * **次の日数よりも古い結果を削除：**&#x200B;ファイルやフォルダーを削除するまでに待機する時間を日数で指定します。この設定は、結果フォルダーに常に空き容量を確保しておきたい場合に役立ちます。-1 を指定すると、結果フォルダーの削除は行われません。デフォルト値は -1 です。
   * **結果フォルダー名：**&#x200B;結果を保存するフォルダーの名前を指定します。結果がこのフォルダーに表示されない場合は、失敗フォルダーを確認してください。読み取り専用ファイルは処理されず、失敗フォルダーに保存されます。絶対パスまたは相対パスを、次のファイルパターンと共に使用できます。

      * %F = ファイル名接頭辞
      * %E = ファイル拡張子
      * %Y = 年（4 桁表記）
      * %y = 年（下 2 桁）
      * %M = 月
      * %D = 日（1～31）
      * %d = 日（通日）
      * %H = 時（24 時間）
      * %h = 時（12 時間）
      * %m = 分
      * %s = 秒
      * %l = ミリ秒
      * %R = 乱数（0～9）
      * %P = プロセス ID またはジョブ ID
      * 例えば、2009年7月17日午後 8 時（PT）で、C:/Test/WF0/failure/%Y/%M/%D/%H/ と指定した場合、結果フォルダーは C:/Test/WF0/failure/2009/07/17/20 となります。
      * 絶対パスではなく相対パスを指定すると、そのフォルダーは監視フォルダーの中に作成されます。デフォルト値は「result/%Y/%M/%D/」であり、監視フォルダー内の結果フォルダーです。ファイルパターンについて詳しくは、「[ファイルパターンについて](/help/forms/using/admin-help/configuring-watched-folder-endpoints.md#about-file-patterns)」を参照してください。

   * **失敗フォルダー名**：失敗ファイルが保存されるフォルダーを指定します。この場所は、常に監視フォルダーからの相対パスで指定します。「結果フォルダー」で説明したファイルパターンを使用できます。
   * **フォルダー名を保存**：正常にスキャンされ、取得されたファイルを保存するフォルダーを指定します。絶対パス、相対パスまたは null のディレクトリを指定できます。「結果フォルダー」で説明したファイルパターンを使用できます。デフォルト値は preserve/%Y/%M/%D/ です。
   * **バッチサイズ**：1 回のスキャンで取得されるファイルまたはフォルダーの数を指定します。システムが過負荷の状態になるのを防ぎます。一度にスキャンするファイル数が多すぎる場合、クラッシュする可能性があります。デフォルト値は 2 です。

     スキャンの間隔が小さいと、スレッドによって入力フォルダーが頻繁にスキャンされます。ファイルが頻繁に監視フォルダーに配置される場合は、スキャンの間隔を小さくする必要があります。ファイルが頻繁には配置されない場合は、他のサービスがスレッドを使用できるように、スキャンの間隔を長くとります。

   * **スロットルオン**：このオプションを有効にすると、AEM Forms で同時に処理できる監視フォルダーのジョブ数が制限されます。「バッチサイズ」の値によって、ジョブの最大数が決まります。詳しくは、[ジョブ数の制限](/help/forms/using/admin-help/configuring-watched-folder-endpoints.md#about-throttling)を参照してください。
   * **既存のファイルを類似する名前で上書き**：「True」に設定すると、結果フォルダーと保存用フォルダーにあるファイルが上書きされます。False に設定すると、ファイル名とフォルダー名に数字のインデックス接尾辞が付加されます。デフォルト値は false です。
   * **エラー時にファイルを保存**：「True」に設定すると、エラーが発生した場合に入力ファイルが保存されます。デフォルト値は true です。
   * **パターンを使用したファイルを含める**：スキャンおよび取得の対象とするフォルダーとファイルを決めるために監視フォルダーで使用されるパターンのセミコロン（;）区切りのリストを指定します。例えば、「ファイルパターンを含める」が「input*」の場合、名前が input* に一致するすべてのファイルおよびフォルダーが取得されます。詳細情報については、[管理ヘルプ](/help/forms/using/admin-help/configuring-watched-folder-endpoints.md)を参照してください。
   * **監視フォルダーを非同期的に呼び出す**：呼び出しを非同期型にするか同期型にするかを指定します。デフォルト値は asynchronous（非同期）です。長期間有効なプロセスでは非同期を使用し、一過性のプロセスまたは短期間のみ有効なプロセスでは同期を使用することをお勧めします。
   * **監視フォルダーを有効化**：このオプションを有効にすると、監視フォルダーが有効になります。デフォルト値は True です。

## 既存の監視フォルダーのプロパティを更新 {#modify-properties-of-an-existing-watched-folder}

監視フォルダーの名前の変更のほか、既存の監視フォルダーのすべてのプロパティを変更できます。次の手順を実行して、既存の監視フォルダーのプロパティを変更します。

1. 画面の左上隅にある **Adobe Experience Manager** アイコンを選択します。
1. **ツール**／**Forms**／**監視フォルダーを設定を選択します。**&#x200B;既に設定されている監視フォルダーのリストが表示されます。
1. 監視フォルダー画面の左側で、監視フォルダーを選択して「**編集」を選択します。**&#x200B;監視フォルダーを作成するために必要なフィールドのリストが表示されます。「**基本**」タブに表示されるフィールドは必須です。「詳細」タブには、さらに多くのフィールドが含まれています。これらのほとんどのフィールドにはデフォルトの値が指定されています。これらのプロパティは、必要に応じて変更できます。
1. プロパティを変更した後、「**更新**」を選択します。変更したプロパティが保存されます。
