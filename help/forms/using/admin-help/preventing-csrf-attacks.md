---
title: CSRF 攻撃の防止
seo-title: CSRF 攻撃の防止
description: クロスサイトリクエストフォージェリ（CSRF）攻撃を防止し、ユーザーデータを侵害から保護する方法について説明します。
seo-description: クロスサイトリクエストフォージェリ（CSRF）攻撃を防止し、ユーザーデータを侵害から保護する方法について説明します。
uuid: f3553826-f5eb-40ea-aeb7-90e4ad30598c
contentOwner: admin
content-type: reference
geptopics: SG_AEMFORMS/categories/configuring_user_management
products: SG_EXPERIENCEMANAGER/6.5/FORMS
discoiquuid: a3cbffb7-c1d1-47c2-bcfd-70f1e2d81ac9
translation-type: tm+mt
source-git-commit: b703c59d7d913fc890c713c6e49e7d89211fd998
workflow-type: tm+mt
source-wordcount: '990'
ht-degree: 81%

---


# CSRF 攻撃の防止 {#preventing-csrf-attacks}

## CSRF 攻撃の仕組み {#how-csrf-attacks-work}

クロスサイトリクエストフォージェリ（CSRF）とは、有効なユーザーのブラウザーが悪質なリクエストの送信（iFrame を介する場合あり）に利用される、Web サイトの脆弱性のことです。ブラウザーは Cookie をドメインベースで送信するので、ユーザーが現在アプリケーションにログインしている場合、ユーザーのデータが侵害される可能性があります。

例えば、ブラウザーで管理コンソールにログインしている場合を想定します。リンクを含む電子メールメッセージを受信したとします。リンクをクリックすると、ブラウザーで新しいタブが開かれます。開かれたページには、認証済みの AEM Forms セッションの Cookie を使用して forms サーバーに悪質なリクエストを行う非表示の iFrame が含まれています。User Management は有効な Cookie を受け取るので、そのリクエストが渡されることになります。

## CSRF に関する用語 {#csrf-related-terms}

**リファラー：** リクエストの送信元のソースページのアドレス。 例えば、site1.com 上の Web ページに site2.com へのリンクが含まれています。このリンクをクリックすると、リクエストが site2.com にポストされます。このリクエストは site1.com のページを発信元としているので、このリクエストのリファラーは site1.com です。

**許可されたURI:** URIはリクエスト対象のformsサーバー上のリソースを識別します（例：/adminui、/contentspace）。 一部のリソースでは、外部のサイトからリクエストがアプリケーションにアクセスすることができます。これらのリソースは、許可されたURIと見なされます。 formsサーバーは、許可されたURIからリファラーのチェックを実行しません。

**nullリファラー：** ブラウザーの新しいウィンドウまたはタブを開き、アドレスを入力してEnterキーを押すと、リファラーはnullになります。 リクエストはまったく新規で、親 Web ページから生成されたものではないので、このリクエストのリファラーはありません。AEM Forms サーバーは、以下の場合に null リファラーを受け取ることができます。

* SOAP または REST エンドポイントで Acrobat からリクエストが送信された場合
* AEM Forms の SOAP または REST エンドポイントで任意のデスクトップクライアントから HTTP リクエストが送信された場合
* ブラウザーの新しいウィンドウが開かれ、任意の AEM forms Web アプリケーションログインページの URL が入力された場合

SOAP および REST エンドポイントで null リファラーを許可してください。すべての URI ログインページ（/adminui、/contentspace、それらに対応するマッピングされたリソースなど）でも、null リファラーを許可してください。例えば、/contentspace に対してマップされたサーブレット /contentspace/faces/jsp/login.jsp は、null リファラーの例外とすることが必要です。この例外は、Web アプリケーションで GET フィルタリングを有効にしている場合にのみ必要です。null リファラーを許可するかどうかはアプリケーションで指定できますSee “Protecting from Cross-Site Request Forgery attacks” in [Hardening and Security for AEM forms](https://help.adobe.com/en_US/livecycle/11.0/HardeningSecurity/index.html).

**許可されているリファラーの例外：** 許可されているリファラーの例外は、許可されているリファラーのリストのサブリストで、このリファラーの例外からの要求はブロックされます。 許可されているリファラーの例外は、Web アプリケーション用です。許可されているリファラーのサブセットが特定のWebアプリケーションの呼び出しを許可されていない場合、許可されているリファラーの例外を使用してリファラーをブロックリストできます。 許可されているリファラーの例外は、アプリケーションの web.xml ファイル内で指定されます（「ヘルプとチュートリアル」ページの「AEM Forms の堅牢化とセキュリティ」内の「クロスサイト要求偽造攻撃からの保護」を参照。）

## 許可されているリファラーの機能の仕組み {#how-allowed-referers-work}

AEM Forms にはリファラーのフィルタリング機能が用意されており、CSRF 攻撃の防止に役立ちます。以下にリファラーのフィルタリングが機能する仕組みを示します。

1. forms サーバーが、呼び出しに使用される HTTP メソッドを確認します。

   * POST の場合、forms サーバーはリファラーのヘッダーのチェックを実行します。
   * GET の場合、forms サーバーはリファラーをチェックしません。ただし、CSRF_CHECK_GETS が true に設定されている場合は除きます。この場合、forms サーバーはリファラーヘッダーを確認します。CSRF_CHECK_GETS は、アプリケーションの web.xml ファイル内で指定されます。（『[堅牢化とセキュリティガイド](https://help.adobe.com/en_US/livecycle/11.0/HardeningSecurity/index.html)』の「クロスサイト要求偽造攻撃からの保護」を参照。）

1. formsサーバーは、要求されたURIが許可されているかどうかを確認します。

   * URIが許可されている場合、サーバーは要求を渡します。
   * 要求されたURIが許可されていない場合、サーバーは要求のリファラーを取得します。

1. リクエスト内にリファラーが含まれている場合、サーバーはそれが許可されているリファラーかどうかを確認します。許可されているリファラーの場合、サーバーはリファラーの例外かどうかを確認します。

   * 例外の場合、リクエストはブロックされます。
   * 例外でない場合、リクエストは渡されます。

1. リクエスト内にリファラーが含まれていない場合、サーバーは null リファラーが許可されているかどうかを確認します。

   * null リファラーが許可されている場合、リクエストは渡されます。
   * null リファラーが許可されていない場合、サーバーはリクエストされた URI が null リファラーの例外であるかどうかを確認し、確認結果に応じてリクエストを処理します。

## 許可されているリファラーの設定 {#configure-allowed-referers}

Configuration Manager を実行すると、許可されているリファラーリストにデフォルトのホストおよび IP アドレス、または forms サーバーが追加されます。このリストは管理コンソールで編集できます。

1. 管理コンソールで、設定／User Management／設定／許可されているリファラー URL を設定をクリックします。許可されているリファラーリストがページ下部に表示されます。
1. 許可されているリファラーを追加するには

   * ホストの名前または IP アドレスを「許可されているリファラー」ボックスに入力します。一度に複数の許可されているリファラーを追加するには、各ホストの名前または IP アドレスを 1 行ごとに入力します。
   * 「HTTP ポート」と「HTTPS ポート」ボックスについて、HTTP または HTTPS のいずれか、または両方のポートを指定します。これらのポートを空のままにした場合、デフォルトのポート（HTTP ではポート 80、HTTPS ではポート 443）が使用されます。ボックスに `0`（ゼロ）を入力した場合、そのサーバー上のすべてのポートが有効化されます。特定のポート番号を入力すると、そのポートのみが有効化されます。
   * 「追加」をクリックします。

1. 許可されているリファラーリストからエントリを削除するには、リストから項目を選択して、「削除」をクリックします。

   許可されているリファラーリストが空の場合、CSRF 機能は動作を停止し、システムのセキュリティが低下します。

1. 許可されているリファラーリストを変更したら、AEM forms サーバーを再起動してください。

