---
title: AEM forms のバックアップと回復方法
description: データをバックアップし、AEM forms のデータと同期を保つための方法を実装する方法を説明します。
contentOwner: admin
content-type: reference
geptopics: SG_AEMFORMS/categories/aem_forms_backup_and_recovery
products: SG_EXPERIENCEMANAGER/6.5/FORMS
exl-id: 01ec6ebc-6d80-4417-9604-c8571aebb57e
source-git-commit: 5bdf42d1ce7b2126bfb2670049deec4b6eaedba2
workflow-type: tm+mt
source-wordcount: '1491'
ht-degree: 22%

---

# AEM forms のバックアップと回復方法{#backup-and-recovery-strategy-for-aem-forms}

AEM forms の実装環境で、追加のカスタムデータを別のデータベースに格納している場合は、そのデータをバックアップする方法を導入し、AEM forms データと同期を維持する必要があります。 また、追加のデータベースを同期しないシナリオにも対処できるように、アプリケーションを堅牢な方法で設計する必要があります。一貫性のある状態を維持するために、実行するデータベース操作をトランザクションコンテキストで行うことを強くお勧めします。

AEM forms の使用方法を特定したら、バックアップする必要のあるファイル、バックアップの頻度、使用可能にするバックアップウィンドウを決定します。

>[!NOTE]
>
>AEM Forms の実装の他の側面と同様に、バックアップと回復戦略は、実稼動環境で使用する前に、開発環境またはステージング環境で開発およびテストして、データを失うことなく、ソリューション全体が期待どおりに動作することを確認する必要があります。

Adobe Experience Manager(AEM) は、AEM forms の不可欠な構成要素です。 AEM Manager は、AEM Forms のAEM部分に格納されたデータに基づいて、AEM Forms のバックアップと同期する必要があります。データの損失を防ぐには、GDS とAEM (repository) をデータベース参照と関連付けるように、AEM Forms 固有のデータをバックアップする必要があります。元のコンピュータと同じ DNS 名のコンピュータに復元されました。

## バックアップのタイプ {#types-of-backups}

AEM forms のバックアップ方法には、次の 2 種類のバックアップが含まれます。

**システムイメージ：**&#x200B;ハードドライブまたはコンピューター全体の機能が停止した場合に、コンピューターの内容を復元するのに使用できる完全なシステムバックアップ。システムイメージのバックアップは、AEM forms の実稼動デプロイメントの前にのみ必要です。 社内ポリシーにより、システムイメージのバックアップが必要な頻度が決まります。

**AEM Forms 固有のデータ：**&#x200B;アプリケーションデータは、データベース、グローバルドキュメントストレージ（GDS）、AEM リポジトリに存在し、リアルタイムにバックアップされる必要があります。GDS は、プロセス内で使用される長期間有効なファイルの保存に使用されるディレクトリです。 これらのファイルには、PDF、ポリシー、またはフォームテンプレートが含まれます。

>[!NOTE]
>
>Content Services（非推奨）がインストールされている場合は、コンテンツ保存場所のルートディレクトリもバックアップします。 [コンテンツ保存場所のルートディレクトリ（Content Services のみ）](/help/forms/using/admin-help/files-back-recover.md#content-storage-root-directory-content-services-only)を参照してください。

このデータベースは、フォームアーティファクト、サービス設定、プロセス状態、および GDS ファイルへのデータベース参照を保存するために使用されます。 データベースへのドキュメントの保存を有効にした場合、GDS 内の永続的なデータとドキュメントもデータベースに保存されます。 データベースは、次の方法を使用してバックアップおよび復元できます。

* **スナップショットバックアップ** mode は、AEM forms システムが無期限または指定された分数でバックアップモードになっている場合に、その後はバックアップモードが有効になりません。 スナップショットバックアップモードを開始または終了するには、次のいずれかのオプションを使用します。 リカバリシナリオの後は、スナップショットのバックアップモードを有効にしないでください。

   * 管理コンソールのバックアップ設定ページを使用します。 スナップショットモードに入るには、[ セーフバックアップモードで動作する ] チェックボックスをオンにします。 このチェックボックスの選択を解除すると、スナップショットモードが終了します。
   * LCBackupMode スクリプトを使用します ( [データベース、GDS およびコンテンツ保存場所のルートディレクトリのバックアップ](/help/forms/using/admin-help/backing-aem-forms-data.md#back-up-the-database-gds-aem-repository-and-content-storage-root-directories)) をクリックします。 スナップショットバックアップモードを終了するには、スクリプトの引数で `continuousCoverage` パラメーターを `false` に設定するか、`leaveContinuousCoverage` オプションを使用します。
   * 提供されたバックアップ／リカバリ API を使用します。<!-- Fix broken link(see AEM forms API Reference section on AEM Forms Help and Tutorials page).-->

* **ローリングバックアップ** mode は、システムが常にバックアップモードになり、前のセッションが解放されるとすぐに新しいバックアップモードセッションが開始されることを示します。 ローリングバックアップモードにタイムアウトが関連付けられていません。 LCBackupMode スクリプトまたは API が呼び出されてローリングバックアップモードを終了すると、新しいローリングバックアップモードセッションが開始されます。 このモードは、継続的なバックアップをサポートするのに役立ちますが、古いドキュメントや不要なドキュメントを GDS ディレクトリから消去することもできます。 ローリングバックアップモードは、[ バックアップと回復 ] ページではサポートされていません。 回復シナリオの後、ローリングバックアップモードは引き続き有効になります。 継続的なバックアップモード（ローリングバックアップモード）を終了するには、LCBackupMode スクリプトで `leaveContinuousCoverage` オプションを使用します。

>[!NOTE]
>
>ローリングバックアップモードを終了すると、すぐに新しいバックアップモードセッションが開始します。ローリングバックアップモードを完全に無効にするには、スクリプトで `leaveContinuousCoverage` オプションを使用します。これによって、既存のローリングバックアップセッションが上書きされます。スナップショットバックアップモードの場合は、通常どおりにバックアップモードを終了できます。

データの損失を防ぐために、AEM Forms 固有のデータは、GDS およびコンテンツ保存場所のルートディレクトリドキュメントとデータベース参照との関連を確実に保つようにバックアップする必要があります。

>[!NOTE]
>
>GDS がデータベースではなくファイルシステムに保存されている場合は、GDS バックアップの前にデータベースのバックアップを実行します。

## バックアップとリカバリに関する特別な考慮事項 {#special-considerations-for-backup-and-recovery}

次の変更が原因で、AEM forms を別の環境で回復する必要がある場合は、次のガイドラインを使用します。

* AEM forms サーバーの IP アドレス、ホスト名またはポートの変更
* ドライブ文字またはディレクトリパスの変更
* 別のデータベースホスト、ポート、または名前への変更

通常、このような回復シナリオは、アプリケーションサーバー、データベースサーバー、または forms サーバーをホストするサーバーのハードウェア障害が原因で発生します。 この節で説明するAEM forms 固有の設定に加えて、AEM forms サーバーのホスト名または IP アドレスが変更された場合は、ロードバランサーやファイアウォールなど、AEM forms のデプロイメントの他の部分にも必要な変更を加える必要があります。

### 変更できないもの {#what-cannot-be-changed}

データベースサーバーやその他の多くのパラメーターを変更できますが、バックアップからAEM forms を回復する場合、アプリケーションサーバーの種類やデータベースの種類を変更することはできません。 例えば、AEM forms のバックアップを復元する場合、アプリケーションサーバーを JBoss から WebLogic に、またはデータベースをOracleから DB2 に変更することはできません。 また、回復したAEM forms では、フォントディレクトリなど、同じファイルシステムパスを使用する必要があります。

### 回復後の再起動 {#restarting-after-a-recovery}

回復後に forms サーバーを再起動する前に、以下の手順を実行します。

1. メンテナンスモードでシステムを起動します。
1. 次の操作を実行して、Form Manager がメンテナンスモードでAEM forms と同期されるようにします。

   1. https://&lt;*サーバー*>:&lt;*ポート*>/lc/fm にアクセスし、管理者／パスワードの認証情報を使用してログインします。
   1. 右上隅にあるユーザーの名前（この場合は「Super Administrator」）をクリックします。
   1. クリック **管理オプション**.
   1. クリック **開始** をクリックして、リポジトリーからアセットを同期します。

1. クラスター環境では、AEM のプライマリノードはセカンダリノードよりも前に立ち上げる必要があります。
1. システムの通常の操作が検証されるまで、Web、SOAP、EJB のプロセスイニシエーターなどの内部ソースまたは外部ソースからプロセスが開始されないことを確認します。

メインのAEM forms データベースを移動または変更した場合は、使用しているアプリケーションサーバーに関連するインストールガイドで、AEM forms データソース IDP_DS および EDC_DS のデータベース接続情報の更新に関する情報を確認してください。

### AEM forms のホスト名または IP アドレスの変更 {#changing-the-aem-forms-hostname-or-ip-address}

クラスターで、UDP ではなく TCP キャッシュを使用する場合は、キャッシュロケーターの構成を更新する必要があります。 ご使用のアプリケーションサーバーに対応する設定ガイドの「キャッシュロケーターの設定（TCP を使用するキャッシュのみ）」を参照してください。

### AEM forms ノードのファイルシステムパスの変更 {#changing-the-aem-forms-node-file-system-paths}

スタンドアロンノードのファイルシステムパスを変更する場合は、環境設定、他のシステム設定、カスタムアプリケーション、デプロイ済みのAEM forms アプリケーションの適切な参照を更新する必要があります。 一方、クラスタの場合、すべてのノードで同じファイルシステムパス設定を使用する必要があります。 グローバルドキュメントストレージ (GDS) のルートディレクトリを設定し、そのディレクトリが、復元されたデータベースと同期している、復元された GDS のコピーを指していることを確認する必要があります。 GDS パスの設定は重要です。GDS には、アプリケーションサーバーの再起動後も保持されるデータを含めることができるからです。

クラスター環境では、バックアップ前とリカバリ後のすべてのクラスターノードに対して、リポジトリのファイルシステムパス設定を同じにする必要があります。

ファイルシステムのパスを変更した後に GDS のパスを設定するには、`[*aem-forms root]*\sdk\misc\Foundation\SetGDSCommandline` フォルダーにある `LCSetGDS` スクリプトを使用します。詳しくは、同じフォルダー内の `ReadMe.txt` ファイルを参照してください。古い GDS ディレクトリパスを使用できない場合は、AEM forms を起動する前に、`LCSetGDS` スクリプトを使用して GDS に新しいパスを設定する必要があります。

>[!NOTE]
>
>この状況は、このスクリプトを使用して GDS の場所を変更する必要がある唯一の状況です。AEM Forms の実行中に GDS の場所を変更するには、管理コンソールを使用します。（[一般的な AEM Forms の設定](/help/forms/using/admin-help/configure-general-aem-forms-settings.md#configure-general-aem-forms-settings)を参照）。

GDS パスを設定した後、forms サーバーをメンテナンスモードで起動し、管理コンソールを使用して新しいノードの残りのファイルシステムパスを更新します。 必要なすべての設定が更新されたことを確認したら、AEM forms を再起動し、テストします。
