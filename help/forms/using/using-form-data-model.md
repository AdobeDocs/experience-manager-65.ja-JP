---
title: フォームデータモデルの使用
description: ここでは、フォームデータモデルを使用してアダプティブフォームとインタラクティブ通信を作成し、それらを使用する方法について説明します。
products: SG_EXPERIENCEMANAGER/6.5/FORMS
topic-tags: integration
docset: aem65
feature: Form Data Model
exl-id: 9a73a643-7ad4-49aa-a971-08d52679158d
solution: Experience Manager, Experience Manager Forms
source-git-commit: 76fffb11c56dbf7ebee9f6805ae0799cd32985fe
workflow-type: tm+mt
source-wordcount: '1268'
ht-degree: 100%

---

# フォームデータモデルの使用{#use-form-data-model}

| バージョン | 記事リンク |
| -------- | ---------------------------- |
| AEM as a Cloud Service | [ここをクリックしてください](https://experienceleague.adobe.com/docs/experience-manager-cloud-service/content/forms/integrate/use-form-data-model/create-form-data-models.html?lang=ja) |
| AEM 6.5 | この記事 |


![hero-image](do-not-localize/data-integration.png)

AEM Forms のデータ統合機能により、各種のバックエンドデータソースを使用してフォームデータモデルを作成できます。作成したデータフォームは、様々なアダプティブフォームとインタラクティブ通信のワークフローで、スキーマとして使用できます。そのためには、データソースの設定を行い、そのデータソース内の有効なデータモデルオブジェクトとデータモデルサービスに基づいて、フォームデータモデルを作成する必要があります。詳しくは、以下のトピックを参照してください。

* [AEM Forms のデータ統合機能](../../forms/using/data-integration.md)
* [データソースの設定](../../forms/using/configure-data-sources.md)
* [フォームデータモデルの作成](../../forms/using/create-form-data-models.md)
* [フォームデータモデルの操作](../../forms/using/work-with-form-data-model.md)

JSON スキーマの拡張機能であるフォームデータモデルを使用して、以下の処理を行うことができます。

* [アダプティブフォームとアダプティブフォームフラグメントを作成する](#create-af)
* [インタラクティブ通信と、構築ブロック（テキストフラグメント、リストフラグメント、条件フラグメントなど）を作成する](#create-ic)
* [サンプルデータを使用してインタラクティブ通信のプレビューを表示する](#preview-ic)
* [アダプティブフォームとインタラクティブ通信に事前にデータを取り込む](#prefill)
* [送信されたアダプティブフォームのデータをデータソースに書き込む](#write-af)
* [アダプティブフォームのルールを使用してサービスを呼び出す](#invoke-services)

## アダプティブフォームとアダプティブフォームフラグメントを作成する {#create-af}

フォームデータモデルに基づいて、[アダプティブフォーム](../../forms/using/creating-adaptive-form.md)と[アダプティブフォームフラグメント](../../forms/using/adaptive-form-fragments.md)を作成できます。フォームデータモデルを使用してアダプティブフォームまたはアダプティブフォームフラグメントを作成するには、以下の手順を実行します。

1. プロパティを追加画面の「フォームモデル」タブで、 **[!UICONTROL 次から選択]** ドロップダウンリストから「**[!UICONTROL フォームデータモデル]**」を選択します。

   ![create-af-1-1](assets/create-af-1-1.png)

1. 「**[!UICONTROL フォームデータモデルを選択]**」を選択して展開します。すべての有効なフォームデータモデルが一覧表示されます。

   フォームデータモデルを選択します。

   ![create-af-2-1](assets/create-af-2-1.png)

1. （**アダプティブフォームフラグメントのみ**）フォームデータモデル内の 1 つのデータモデルオブジェクトのみに基づいて、アダプティブフォームフラグメントを作成できます。**[!UICONTROL フォームデータモデル定義]**&#x200B;ドロップダウンを展開します。指定したフォームデータモデル内のすべてのデータモデルオブジェクトがリスト表示されます。リストからデータモデルオブジェクトを選択します。

   ![create-af-3](assets/create-af-3.png)

フォームデータモデルに基づいてアダプティブフォームまたはアダプティブフォームフラグメントを作成すると、アダプティブフォームエディターのコンテンツブラウザーの「**[!UICONTROL データモデルオブジェクト]**」タブにフォームデータモデルオブジェクトが表示されます。

>[!NOTE]
>
>アダプティブフォームフラグメントの場合は、オーサリング時に選択したデータモデルオブジェクトと、そのオブジェクトに関連付けられているデータモデルオブジェクトだけが、「データモデルオブジェクト」タブに表示されます。

![data-model-objects-tab](assets/data-model-objects-tab.png)

データモデルオブジェクトをアダプティブフォームまたはアダプティブフォームフラグメントにドラッグアンドドロップすると、フォームフィールドを追加することができます。追加されたフォームフィールドには、メタデータのプロパティが保持され、データモデルオブジェクトのプロパティとの連結が保持されます。この連結により、フォームの送信時は、対応するデータソース内のフィールド値が更新され、フォームのレンダリング時は、対応するデータソース内のフィールドに値が取り込まれます。

## インタラクティブ通信を作成 {#create-ic}

フォームデータモデルに基づいて、インタラクティブ通信を作成できます。フォームデータモデルを使用して、設定済みデータソースのデータをインタラクティブ通信に事前に取り込むことができます。また、フォームデータモデルに基づいて、インタラクティブ通信の構築ブロック（テキスト、リストおよび条件のドキュメントフラグメントなど）を作成できます。

インタラクティブ通信またはドキュメントフラグメントを作成する際に、フォームデータモデルを選択できます。次の図は、インタラクティブ通信を作成ダイアログの「一般」タブを示しています。

![create-ic](assets/create-ic.png)

インタラクティブ通信を作成ダイアログの「一般」タブ

詳しくは、次を参照してください。

[インタラクティブ通信の作成](../../forms/using/create-interactive-communication.md)

[インタラクティブ通信内のテキスト](/help/forms/using/texts-interactive-communications.md)

[インタラクティブ通信内の条件](/help/forms/using/conditions-interactive-communications.md)

[リストフラグメント](/help/forms/using/lists.md)

## サンプルデータを使用したプレビュー {#preview-ic}

フォームデータモデルエディターでは、フォームデータモデル内のデータモデルオブジェクト用のサンプルデータを生成して編集できます。このデータを使用すると、インタラクティブ通信とアダプティブフォームをプレビューおよびテストできます。プレビュー表示を行う前に、[フォームデータモデルの操作](../../forms/using/work-with-form-data-model.md#sample)の説明に従って、サンプルデータを生成します。

サンプルのフォームデータモデルのデータを使用してインタラクティブ通信をプレビューするには：

1. AEM オーサーインスタンスで、**[!UICONTROL フォーム／フォームとドキュメント]**&#x200B;に移動します。
1. インタラクティブ通信を選択してツールバーで「**[!UICONTROL プレビュー]**」を選択し、「**[!UICONTROL Web チャネル]**」、「**[!UICONTROL 印刷チャネル]**」、または「**[!UICONTROL 両方のチャネル]**」を選択します。これにより、選択したインタラクティブ通信のプレビューが表示されます。
1. プレビューの&#x200B;[*チャネル*]&#x200B;ダイアログで、「**[!UICONTROL フォームデータモデルのデータのテスト]**」が選択されていることを確認して「**[!UICONTROL プレビュー]**」を選択します。

サンプルデータが取り込まれた状態のインタラクティブ通信が表示されます。

![web-preview](assets/web-preview.png)

同様に、サンプルデータが取り込まれた状態のアダプティブフォームをプレビュー表示するには、作成者モードでアダプティブフォームを開いて「**[!UICONTROL プレビュー]**」を選択します。

## フォームデータモデルサービスを使用したデータの事前入力 {#prefill}

AEM Forms には、すぐに使用できるフォームデータモデル事前入力サービスが用意されています。フォームデータモデルに基づいて、このサービスをアダプティブフォームおよびインタラクティブ通信で使用することができます。この事前入力サービスは、アダプティブフォームおよびインタラクティブ通信内のデータモデルオブジェクトに対してデータソースのクエリを実行し、フォームまたは通信のレンダリング時にデータを事前入力します。

アダプティブフォームに対してフォームデータモデル事前入力サービスを有効にするには、アダプティブフォームコンテナのプロパティを開き、基本アコーディオンの&#x200B;**[!UICONTROL 事前入力サービス]**&#x200B;ドロップダウンで「**[!UICONTROL フォームデータモデル事前入力サービス]**」を選択します。次に、各プロパティを保存します。

![prefill-service](assets/prefill-service.png)

インタラクティブ通信でフォームデータモデル事前入力サービスを設定するには、インタラクティブ通信の作成時に「事前入力サービス」ドロップダウンで「フォームデータモデル事前入力サービス」を選択します。後でプロパティを編集することもできます。

![edit-ic-props](assets/edit-ic-props.png)

インタラクティブ通信のプロパティ編集ダイアログ

## 送信されたアダプティブフォームデータのデータソースへの書き込み {#write-af}

ユーザーがフォームデータモデルに基づいてフォームを送信するとき、データモデルオブジェクトの送信データがそのデータソースに書き込まれるようにフォームを設定することができます。この設定を行うために、AEM Forms には、すぐに使用できる[フォームデータモデル送信アクション](../../forms/using/configuring-submit-actions.md)が用意されています。これは、フォームデータモデルをベースとするアダプティブフォーム専用のアクションです。これにより、データモデルオブジェクトに送信されたデータが、そのデータソースに書き込まれます。

フォームデータモデル送信アクションを設定するには、アダプティブフォームコンテナのプロパティを開き、送信アコーディオンの「送信アクション」ドロップダウンで「**[!UICONTROL フォームデータモデルを使用して送信]**」を選択します。次に、 **[!UICONTROL 送信するデータモデルオブジェクトの名前]** ドロップダウンで、目的のデータモデルオブジェクトを探して選択します。各プロパティを保存します。

フォームを送信すると、設定されているデータモデルオブジェクトのデータが、各データソースに書き込まれます。

![data-submission](assets/data-submission.png)

バイナリデータモデルオブジェクトのプロパティを使用して、フォームの添付ファイルをデータソースに送信することもできます。添付ファイルを JDBC データソースに送信するには、次の手順を実行します。

1. バイナリプロパティを含むデータモデルオブジェクトをフォームデータモデルに追加します。
1. アダプティブフォームで、「**[!UICONTROL 添付ファイル]**」コンポーネントをコンポーネントブラウザーからアダプティブフォームにドラッグ＆ドロップします。
1. 追加されたコンポーネントを選択し、次に ![settings_icon](assets/settings_icon.png) を選択して、そのコンポーネントのプロパティブラウザーを開きます。
1. 「バインド参照」フィールドで ![foldersearch_18](assets/foldersearch_18.png) を選択し、フォームデータモデルに追加したバイナリプロパティに移動してそのプロパティを選択します。必要に応じて、他のプロパティを設定します。

   ![check-button](assets/check-button.png) を選択して、プロパティを保存します。これで、添付ファイルフィールドがフォームデータモデルのバイナリプロパティに連結されます。

1. アダプティブフォームコンテナプロパティの「送信」セクションで、「**[!UICONTROL フォームの添付ファイルを送信]**」を有効にします。これで、フォーム送信時に、バイナリプロパティフィールド内の添付ファイルがデータソースに送信されます。

## ルールを使用したアダプティブフォーム内のサービスの呼び出し {#invoke-services}

フォームデータモデルに基づくアダプティブフォームの場合、[ルールを作成](../../forms/using/rule-editor.md)して、フォームデータモデル内で設定されているサービスを呼び出すことができます。ルール内の「**[!UICONTROL サービスを起動]**」操作を実行すると、フォームデータモデル内のすべての有効なサービスが一覧表示され、サービスの入力フィールドと出力フィールドを選択できます。「**指定値**」というルールタイプを使用してフォームデータモデルサービスを呼び出し、そのサービスから返された出力に対するフィールドの値を設定することもできます。

例えば以下のルールの場合、従業員 ID を入力として使用する Get サービスが呼び出され、このサービスから返された値が、フォーム内の対応する扶養家族 ID フィールド、姓フィールド、名フィールド、性別フィールドに設定されます。

![invoke-service](assets/invoke-service.png)

また、`guidelib.dataIntegrationUtils.executeOperation` API を使用して、ルールエディターのコードエディターで JavaScript を記述することもできます。API について詳しくは、「[フォームデータモデルサービスを呼び出すための API](/help/forms/using/invoke-form-data-model-services.md)」を参照してください。
