---
title: AEM Formsのバックアップの準備
seo-title: AEM Formsのバックアップの準備
description: Java APIとWeb Service APIを使用して、Backup and Restoreサービスを使用し、AEM Formsサーバーのバックアップモードを開始および終了する方法について説明します。
seo-description: Java APIとWeb Service APIを使用して、Backup and Restoreサービスを使用し、AEM Formsサーバーのバックアップモードを開始および終了する方法について説明します。
uuid: b8ef2bed-62e2-4000-b55a-30d2fc398a5f
contentOwner: admin
content-type: reference
products: SG_EXPERIENCEMANAGER/6.5/FORMS
topic-tags: operations
discoiquuid: e747147e-e96d-43c7-87b3-55947eef81f5
role: Developer
exl-id: aeab003d-ba64-4760-9c56-44638501e9ff
source-git-commit: b220adf6fa3e9faf94389b9a9416b7fca2f89d9d
workflow-type: tm+mt
source-wordcount: '2554'
ht-degree: 2%

---

# AEM Formsのバックアップの準備{#preparing-aem-forms-for-backup}

**このドキュメントのサンプルと例は、JEE上のAEM Forms環境に限られています。**

## バックアップと復元サービスについて{#about-the-backup-and-restore-service}

バックアップと復元サービスを使用すると、AEM Formsを&#x200B;*バックアップモード*&#x200B;にすることができ、これによりホットバックアップを実行できます。 バックアップと復元サービスは、実際にはAEM Formsのバックアップを実行したり、システムを復元したりしません。 代わりに、サーバを一貫性と信頼性の高いバックアップの状態にし、サーバを引き続き実行できるようにします。 グローバルドキュメントストレージ(GDS)とformsサーバーに接続されたデータベースをバックアップするアクションは、ユーザーが担当します。 GDSは、長期間有効なプロセス内で使用されるファイルの保存に使用されるディレクトリです。

バックアップモードとは、バックアップ手順の実行中にGDS内のファイルがパージされないように、サーバーが起動する状態です。 代わりに、GDSディレクトリの下にサブディレクトリが作成され、保存バックアップモードの終了後にパージされるファイルの記録が維持されます。 ファイルは、システムの再起動後も何日もまたは何年も続く可能性があり、 これらのファイルは、formsサーバーの全体的な状態の重要な部分であり、PDFファイル、ポリシー、フォームテンプレートなどが含まれる場合があります。 これらのファイルが失われたり破損したりした場合は、formsサーバー上のプロセスが不安定になり、データが失われる可能性があります。

スナップショット・バックアップを実行する場合は、通常、一定期間バックアップ・モードに入り、バックアップ・アクティビティの完了後にバックアップ・モードを終了します。 バックアップモードを終了すると、ファイルが不必要に大きくならないようにGDSからパージされる必要があります。 バックアップモードを明示的に終了するか、バックアップモードセッションで期限が切れるまで待つことができます。

また、サーバを永続バックアップモードのままにすることもできます。これは、ローリングバックアップや継続的なシステム有効範囲のバックアップ戦略に典型的なものです。 ローリングバックアップモードは、システムが常にバックアップモードになり、前のセッションが解放されるとすぐに新しいバックアップモードセッションが開始されることを示します。 連続バックアップモードの場合、ファイルは2回のバックアップモードセッションの後にパージされ、参照されなくなります。

Backup and Restoreサービスを使用して、既存のアプリケーションや、Formsサーバーに接続されたGDSまたはデータベースのバックアップを実行するために作成する新しいアプリケーションに追加できます。

>[!NOTE]
>
>AEM Forms実装のその他の側面と同様に、バックアップと回復戦略は、実稼動環境で使用する前に、開発環境またはステージング環境で開発およびテストし、データを失うことなくソリューション全体が期待どおりに動作することを確認する必要があります。

バックアップと復元サービスを使用して、次のタスクを実行できます。

* バックアップモードに入ります。
* バックアップモードを終了します。

>[!NOTE]
>
>AEM Formsのバックアップを実行する際に考慮すべき点について詳しくは、[管理ヘルプ](https://www.adobe.com/go/learn_aemforms_admin_63)を参照してください。

>[!NOTE]
>
>バックアップと復元サービスの詳細については、『[AEM Formsのサービスリファレンス](https://www.adobe.com/go/learn_aemforms_services_63)』を参照してください。

## formsサーバーのバックアップモードに入ります{#entering-backup-mode-on-the-forms-server}

formsサーバーのホットバックアップを許可するには、バックアップモードに入ります。 バックアップモードに入ると、組織のバックアップ手順に基づいて次の情報を指定します。

* バックアップ・プロセスに役立つバックアップ・モード・セッションを識別する一意のラベル。
* バックアップ手順が完了する時刻。
* 連続バックアップモードにするかどうかを示すフラグ。ローリングバックアップを実行する場合にのみ役立ちます。

アプリケーションをバックアップモードにする前に、formsサーバーをバックアップモードにした後に使用するバックアップ手順を理解しておくことをお勧めします。 AEM Formsのバックアップを実行する際に考慮すべき点について詳しくは、[管理ヘルプ](https://www.adobe.com/go/learn_aemforms_admin_63)を参照してください。

>[!NOTE]
>
>バックアップと復元サービスの詳細については、『[AEM Formsのサービスリファレンス](https://www.adobe.com/go/learn_aemforms_services_63)』を参照してください。

### 手順の概要{#summary-of-steps}

バックアップ・モードに入るアプリケーションを作成するには、次の手順を実行します。

1. プロジェクトファイルを含めます。
1. BackupServiceクライアントオブジェクトを作成します。
1. 一意のラベル、バックアップの実行時間、継続的なバックアップ・モードにするかどうかを決定します。
1. バックアップモードに入ります。
1. （オプション）サーバー上のバックアップモードセッションに関する情報を取得します。
1. GDS（グローバルデータストア）とデータベースのバックアップを実行します。

**プロジェクトファイルを含める**

必要なファイルを開発プロジェクトに含めます。 これらのファイルは、コードを正しくコンパイルし、バックアップと復元サービスAPIを使用するために、プロジェクトに含めることが重要です。

これらのファイルの場所については、[AEM Forms Java ライブラリファイルを含める](/help/forms/developing/invoking-aem-forms-using-java.md#including-aem-forms-java-library-files)を参照してください。

**BackupService Client APIオブジェクトの作成**

プログラムによるバックアップモードを終了するには、Backup and Restore Service APIを使用するBackupServiceクライアントオブジェクトを作成します。

**一意のラベルを決定し、バックアップを実行する時間を決定し、連続バックアップ・モードにするかどうかを決定**

バックアップモードに入る前に、固有のラベルを決定し、バックアップの実行に割り当てる時間を決定し、formsサーバーをバックアップモードのままにするかどうかを決定する必要があります。 これらの考慮事項は、お客様の組織が確立したバックアップ手順と統合する際に重要です。 （[管理ヘルプ](https://www.adobe.com/go/learn_aemforms_admin_63)を参照）。

**バックアップモードの開始**

組織のバックアップ手順と一致するパラメータを使用して、バックアップモードに入ります。

**サーバ上のバックアップ・モード・セッションに関する情報を取得する**

バックアップモードに入った後、セッションに関する情報を取得できます。 この情報は、バックアップ手順との統合に使用できます

**GDSとデータベースのバックアップの実行**

バックアップモードに正常に入ったら、グローバルドキュメントストレージ(GDS)とformsサーバーが接続されているデータベースのバックアップを実行できます。 この手順は組織に固有のものです。これは、この手順を手動で実行するか、他のツールを実行してバックアップ手順を実行できるからです。

### Java API {#enter-backup-mode-using-the-java-api}を使用してバックアップモードに入ります

バックアップと復元サービスAPIを使用して、バックアップモードに入ります。

1. プロジェクトファイルを含める

   必要なクライアントJARファイル（ adobe-backup-restore-client-sdk.jarなど）をJavaプロジェクトのクラスパスに含めます。 Javaクライアントアプリケーションを作成するには、次のJARファイルをプロジェクトのクラスパスに追加する必要があります。

   * adobe-backup-restore-client-sdk.jar
   * adobe-livecycle-client.jar
   * adobe-usermanager-client.jar
   * adobe-utilities.jar(AEM FormsがJBoss Application Serverにデプロイされている場合に必要)
   * jbossall-client.jar(AEM FormsがJBoss Application Serverにデプロイされている場合に必要)

1. BackupService Client APIオブジェクトの作成

   `ServiceClientFactory`オブジェクトとBackupServiceクライアントAPIオブジェクトを一緒に使用します。

   * 接続プロパティを含む `ServiceClientFactory` オブジェクトを作成します。（[接続プロパティの設定](/help/forms/developing/invoking-aem-forms-using-java.md#setting-connection-properties)を参照。）
   * コンストラクターを使用して`BackupService`オブジェクトを渡し、`ServiceClientFactory`オブジェクトを作成します。

1. 一意のラベルを決定し、バックアップを実行する時間を決定し、連続バックアップ・モードにするかどうかを決定

   一意のラベルを決定し、バックアップの実行に割り当てる時間を決定し、formsサーバーを連続バックアップモードにするかどうかを決定します。

1. バックアップモードの開始

   `enterBackupMode`メソッドを次のパラメーターで呼び出して、バックアップモードに入ります。

   * バックアップモードセッションを識別する、人間が読み取り可能な一意のラベルを指定する`String`値。 XML形式にエンコードできないスペースや文字は使用しないことをお勧めします。
   * バックアップモードで維持する時間（分）を指定する`int`値。 `1` ～ `10080`の値（1週間の分数）を指定できます。 連続バックアップモードを使用する場合、この値は無視されます。
   * 連続バックアップモードにするかどうかを指定する`Boolean`値。 `True`の値は連続バックアップモードであることを指定します。 連続バックアップモードの場合、バックアップモードに維持する分数に指定した値は無視されます。

      連続バックアップモードとは、現在のバックアップモードが完了した後に、新しいバックアップモードセッションが開始されることを意味します。 値`False`は、連続バックアップモードが使用されないことを意味し、バックアップモードを終了した後、GDSからのファイルのパージが再開されます。

1. サーバ上のバックアップ・モード・セッションに関する情報を取得する

   `enterBackupMode`メソッドを呼び出した後に返される`BackupModeEntryResult`オブジェクトを使用して情報を取得します。 バックアップモードに入った後に取得できる情報は、バックアップ手順との統合に役立つ場合があります。 例えば、ラベル、バックアップID、開始時刻は、バックアップ手順のファイル名の入力として役立つ場合があります。

1. GDSとデータベースのバックアップの実行

   グローバルドキュメントストレージ(GDS)と、Formsサーバーが接続されているデータベースをバックアップします。 バックアップを実行するアクションは、AEM Forms SDKには含まれておらず、組織内のバックアップ手順に固有の手動手順も含まれている場合があります。

### WebサービスAPIを使用してバックアップモードに入ります{#enter-backup-mode-using-the-web-service-api}

バックアップと復元サービスAPIが提供するWebサービスを使用して、バックアップモードに入ります。

1. プロジェクトファイルを含める

   * Backup and Restore Service API WSDLを使用するMicrosoft .NETクライアントアセンブリを作成します。
   * Microsoft .NETクライアントアセンブリを参照します。

1. BackupService Client APIオブジェクトの作成

   Microsoft .NETクライアントアセンブリを使用して、デフォルトのコンストラクタを呼び出し、`Credentials`メソッドを使用して資格情報を指定して、`BackupServiceService`オブジェクトを作成します。

1. 一意のラベルを決定し、バックアップを実行する時間を決定し、連続バックアップ・モードにするかどうかを決定

   一意のラベルを決定し、バックアップの実行に割り当てる時間を決定し、formsサーバーを連続バックアップモードにするかどうかを決定します。

1. バックアップモードの開始

   バックアップモードに入るには、 enterBackupModeメソッドを呼び出して、次の値を渡します。

   * バックアップモードセッションを識別する、人間が読み取り可能な一意のラベルを指定する`String`値。 XML形式にエンコードできないスペースや文字は使用しないことをお勧めします。
   * バックアップモードで維持する時間（分）を指定する`Uint32`値。 `1` ～ `10080`の値（1週間の分数）を指定できます。 連続バックアップモードを使用する場合、この値は無視されます。
   * 連続バックアップモードにするかどうかを指定する`Boolean`値。 `True`の値は連続バックアップモードであることを指定します。 連続バックアップモードの場合、バックアップモードに維持する分数に指定した値は無視されます。 連続バックアップモードとは、現在のバックアップモードが完了した後に、新しいバックアップモードセッションが開始されることを意味します。

      値`False`は、連続バックアップモードが使用されないことを意味し、バックアップモードを終了した後、GDSからのファイルのパージが再開されます。

1. サーバ上のバックアップ・モード・セッションに関する情報を取得する

   成功したことを検証するために返されるBackupModeEntryResultからenterBackupModeメソッドを呼び出した後、バックアップモードセッションに関する情報を取得します。 バックアップモードに入った後に取得できる情報は、バックアップ手順との統合に役立つ場合があります。 例えば、ラベル、バックアップID、開始時刻は、バックアップ手順のファイル名の入力として役立つ場合があります。

1. GDSとデータベースのバックアップの実行

   グローバルドキュメントストレージ(GDS)と、Formsサーバーが接続されているデータベースをバックアップします。 バックアップを実行するアクションは、AEM Forms SDKには含まれておらず、組織内のバックアップ手順に固有の手動手順も含まれている場合があります。

## formsサーバー{#leaving-backup-mode-on-the-forms-server}へのバックアップモードの終了

FormsサーバーがFormsサーバー上のGDS（グローバルドキュメントストレージ）からのファイルのパージを再開できるように、バックアップモードを終了します。

アプリケーションを終了モードにする前に、AEM Formsで使用されるバックアップ手順を理解しておくことをお勧めします。 AEM Formsのバックアップを実行する際に考慮すべき点について詳しくは、[管理ヘルプ](https://www.adobe.com/go/learn_aemforms_admin_63)を参照してください。

>[!NOTE]
>
>バックアップと復元サービスの詳細については、『[AEM Formsのサービスリファレンス](https://www.adobe.com/go/learn_aemforms_services_63)』を参照してください。

### 手順の概要{#summary_of_steps-1}

バックアップモードを終了するには、次の手順を実行します。

1. プロジェクトファイルを含めます。
1. BackupServiceクライアントオブジェクトを作成します。
1. バックアップモードを終了します。
1. （オプション）formsサーバー上で実行されていたバックアップモードセッションに関する情報を取得します。

**プロジェクトファイルを含める**

開発プロジェクトに必要なファイルをすべて含めます。 これらのファイルは、コードを正しくコンパイルし、バックアップと復元サービスAPIを使用する際に重要です。

これらのファイルの場所については、[AEM Forms Java ライブラリファイルを含める](/help/forms/developing/invoking-aem-forms-using-java.md#including-aem-forms-java-library-files)を参照してください。

**BackupService Client APIオブジェクトの作成**

プログラムによるバックアップモードを終了するには、Backup and Restore Service APIを使用するBackupServiceクライアントオブジェクトを作成します。

**バックアップモードを終了**

バックアップモードを終了すると、グローバルドキュメントストレージ(GDS)からのファイルの通常のパージが再開されます。 バックアップモードを終了する前に、バックアップ手順が完了したことを確認する必要があります。

**終了したバックアップモードセッションに関する情報を取得します**

バックアップモードを終了した後、セッションに関する情報を取得できます。 この情報は、バックアップ手順との統合に使用できます。

### Java API {#leave-backup-mode-using-the-java-api}を使用してバックアップモードを終了します

バックアップと復元サービスAPI(Java)を使用して、バックアップモードを終了します。

1. プロジェクトファイルを含める

   必要なクライアントJARファイル（ adobe-backup-restore-client-sdk.jarなど）をJavaプロジェクトのクラスパスに含めます。 Javaクライアントアプリケーションを作成するには、次のJARファイルをプロジェクトのクラスパスに追加する必要があります。

   * adobe-backup-restore-client-sdk.jar
   * adobe-livecycle-client.jar
   * adobe-usermanager-client.jar
   * adobe-utilities.jar(AEM FormsがJBoss Application Serverにデプロイされている場合に必要)
   * jbossall-client.jar(AEM FormsがJBoss Application Serverにデプロイされている場合に必要)

1. BackupService Client APIオブジェクトの作成

   `ServiceClientFactory`オブジェクトとBackupServiceクライアントAPIオブジェクトを一緒に使用します。

   * 接続プロパティを含む `ServiceClientFactory` オブジェクトを作成します。（[接続プロパティの設定](/help/forms/developing/invoking-aem-forms-using-java.md#setting-connection-properties)を参照。）
   * コンストラクターを使用し、`ServiceClientFactory`オブジェクトをパラメーターとして渡して、`BackupService`オブジェクトを作成します。

1. バックアップモードの開始

   `leaveBackupMode`メソッドを呼び出して、バックアップモードを終了します。

1. サーバ上のバックアップ・モード・セッションに関する情報を取得する

   返される`BackupModeResult`オブジェクトを使用して、操作に関する情報を取得します。 バックアップモードに入った後に取得できる情報は、バックアップ手順との統合に役立つ場合があります。 例えば、ラベル、バックアップID、開始時刻は、バックアップ手順のファイル名の入力として役立つ場合があります。

### WebサービスAPI {#leave-backup-mode-using-the-web-service-api}を使用してバックアップモードを終了します

バックアップと復元サービスAPI（Webサービス）を使用して、バックアップモードを終了します。

1. プロジェクトファイルを含める

   Webサービスを使用するには、必ずプロキシファイルを含める必要があります。 バックアップと復元サービスAPIをWebサービスとして使用するようにプロジェクトを設定するには、次の手順に従います。

   * Backup and Restore Service API WSDLを使用するMicrosoft .NETクライアントアセンブリを作成します。
   * Microsoft .NETクライアントアセンブリを参照します。

1. BackupService Client APIオブジェクトの作成

   Microsoft .NETクライアントアセンブリを使用して、デフォルトのコンストラクタを呼び出して`BackupServiceService`オブジェクトを作成します。

1. バックアップモードの開始

   `leaveBackupMode` Webサービス操作を呼び出して、バックアップモードを終了します。

1. サーバ上のバックアップ・モード・セッションに関する情報を取得する

   操作後にバックアップモード識別子を取得し、正常に実行されたことを確認します。 バックアップモードを終了した後に取得できる情報は、バックアップ手順との統合に役立つ場合があります。
