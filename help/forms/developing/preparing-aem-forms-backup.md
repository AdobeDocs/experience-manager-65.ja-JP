---
title: バックアップ用の AEM Forms の準備
description: Java API と web サービス API を使用して、バックアップおよび復元サービスにより AEM Forms サーバーのバックアップモードに入る方法と、バックアップモードを終了する方法について説明します。
contentOwner: admin
content-type: reference
products: SG_EXPERIENCEMANAGER/6.5/FORMS
topic-tags: operations
role: Developer
exl-id: aeab003d-ba64-4760-9c56-44638501e9ff
solution: Experience Manager, Experience Manager Forms
feature: Adaptive Forms,APIs & Integrations
source-git-commit: d7b9e947503df58435b3fee85a92d51fae8c1d2d
workflow-type: tm+mt
source-wordcount: '2484'
ht-degree: 100%

---

# バックアップ用の AEM Forms の準備 {#preparing-aem-forms-for-backup}

**このドキュメントのサンプルと例は、JEE 環境の AEM Forms のみを対象としています。**

## バックアップおよび復元サービスについて {#about-the-backup-and-restore-service}

バックアップおよび復元サービスを使用すると、AEM Forms を&#x200B;*バックアップモード*&#x200B;にして、ホットバックアップを実行できます。バックアップおよび復元サービスは、実際には AEM Forms のバックアップを実行したり、システムを復元したりしません。代わりに、サーバーを継続して実行できるようにしながら、サーバーを一貫性のある信頼性の高いバックアップの状態にします。グローバルドキュメントストレージ（GDS）と Forms サーバーに接続されたデータベースをバックアップするアクションは、ユーザーが担当します。GDS は、長期間有効なプロセス内で使用されるファイルを格納するためのディレクトリです。

バックアップモードとは、バックアップ処理中に GDS 内のファイルがパージされないようにするために、サーバーが入る状態のことです。代わりに、GDS ディレクトリの下にサブディレクトリを作成し、バックアップモードの保存が終了した後にパージされるファイルのレコードを保持します。ファイルは、システムの再起動後も存続することを目的としており、数日、あるいは数年にわたる場合もあります。これらのファイルは、Forms サーバーの全体的な状態を示す重要な部分であり、PDF ファイル、ポリシー、フォームテンプレートなどが含まれることがあります。これらのファイルのいずれかが失われたり破損したりすると、Forms サーバー上の処理が不安定になり、データが失われる可能性があります。

スナップショットバックアップの実行を選択できます。この場合、通常は一定期間バックアップモードに入り、バックアップアクティビティの完了後にバックアップモードを終了します。GDS からファイルをパージして、ファイルが不必要に大きくならないようにするには、バックアップモードを終了する必要があります。バックアップモードを明示的に終了するか、バックアップモードのセッションで時間切れになるのを待ちます。

また、サーバーを永続的なバックアップモードのままにすることもできます。これは、ローリングバックアップや継続的なシステムカバレッジのバックアップ戦略に典型的なものです。ローリングバックアップモードでは、システムが常にバックアップモードになり、前のセッションが解放されるとすぐに新しいバックアップモードセッションが初期化されます。連続バックアップモードでは、ファイルは 2 回のバックアップモードセッションの後にパージされ、参照されなくなります。

バックアップおよび復元サービスを使用して、既存のアプリケーションに、または Forms サーバーに接続された GDS またはデータベースのバックアップを実行するために作成する新しいアプリケーションに、追加できます。

>[!NOTE]
>
>AEM Forms 実装の他の側面と同様に、バックアップと回復の方法は、実稼働環境で使用する前に開発環境またはステージング環境で作成およびテストし、データ損失が発生せずにソリューション全体が期待どおり機能することを確認する必要があります。

バックアップおよび復元サービスを使用して、次のタスクを実行できます。

* バックアップモードに入ります。
* バックアップモードを終了します。

>[!NOTE]
>
>AEM Forms のバックアップを実行する際に考慮すべき事項について詳しくは、[管理ヘルプ](https://www.adobe.com/go/learn_aemforms_admin_63_jp)を参照してください。

>[!NOTE]
>
>バックアップおよび復元サービスについて詳しくは、[AEM Forms のサービスリファレンス](https://www.adobe.com/go/learn_aemforms_services_63)を参照してください。

## Forms サーバーでのバックアップモードに移行 {#entering-backup-mode-on-the-forms-server}

バックアップモードに入ると、Forms サーバーのホットバックアップが可能になります。バックアップモードに入る場合、組織のバックアップ手順に基づいて次の情報を指定します。

* バックアッププロセスに役立つバックアップモードセッションを識別する一意のラベル。
* バックアップ手順が完了するまでの時間。
* 連続バックアップモードにするかどうかを示すフラグ。ローリングバックアップを実行する場合にのみ役立ちます。

バックアップモードに入るためのアプリケーションを作成する前に、Forms サーバーをバックアップモードにした後のバックアップ手順について理解することをお勧めします。AEM Forms のバックアップを実行する際に考慮すべき事項について詳しくは、[管理ヘルプ](https://www.adobe.com/go/learn_aemforms_admin_63_jp)を参照してください。

>[!NOTE]
>
>バックアップおよび復元サービスについて詳しくは、[AEM Forms のサービスリファレンス](https://www.adobe.com/go/learn_aemforms_services_63)を参照してください。

### 手順の概要 {#summary-of-steps}

バックアップモードに入るアプリケーションを作成するには、次の手順を実行します。

1. プロジェクトファイルを含めます。
1. BackupService クライアントオブジェクトを作成します。
1. 一意のラベル、バックアップを実行する時間、継続的なバックアップモードにするかどうかを決定します。
1. バックアップモードに入ります。
1. （オプション）サーバー上のバックアップモードセッションに関する情報を取得します。
1. GDS（グローバルデータストア）とデータベースのバックアップを実行します。

**プロジェクトファイルを含める**

開発プロジェクトに必要なファイルを含めます。これらのファイルは、コードを正しくコンパイルし、バックアップおよび復元サービス API を使用するために、プロジェクトに含めることが重要です。

これらのファイルの場所については、[AEM Forms Java ライブラリファイルを含める](/help/forms/developing/invoking-aem-forms-using-java.md#including-aem-forms-java-library-files)を参照してください。

**BackupService クライアント API オブジェクトを作成**

プログラムでバックアップモードを終了するには、BackupService クライアントオブジェクトを作成して Backup and Restore Service API を使用します。

**一意のラベルを決定し、バックアップを実行する時間を決定し、連続バックアップモードにするかどうかを決定**

バックアップモードに入る前に、一意のラベルを決定し、バックアップの実行に割り当てる時間を決定し、Forms サーバーをバックアップモードのままにするかどうかを決定する必要があります。これらの検討事項は、組織が確立したバックアップ手順と統合する際に重要です。 （[管理ヘルプ](https://www.adobe.com/go/learn_aemforms_admin_63_jp)を参照。）

**バックアップモードに移行**

組織のバックアップ手順と一致するパラメーターを使用して、バックアップモードに入ります。

**サーバー上のバックアップモードセッションに関する情報を取得**

バックアップモードに入った後、セッションに関する情報を取得できます。この情報は、バックアップ手順との統合に使用可能

**GDS とデータベースのバックアップを実行**

バックアップモードに正常に入ったら、グローバルドキュメントストレージ（GDS）と Forms サーバーが接続されているデータベースのバックアップを実行できます。この手順は、手動で実行することも、他のツールを実行してバックアップ手順を実行することもできるので、組織に固有の手順です。

### Java API を使用してバックアップモードに移行 {#enter-backup-mode-using-the-java-api}

バックアップと復元サービス API を使用してバックアップモードに入ります。

1. プロジェクトファイルを含める

   adobe-backup-restore-client-sdk.jar などの必須のクライアント JAR ファイルを Java プロジェクトのクラスパスに含めます。Java クライアントアプリケーションを作成するには、次の JAR ファイルをプロジェクトのクラスパスに追加する必要があります。

   * adobe-backup-restore-client-sdk.jar
   * adobe-livecycle-client.jar
   * adobe-usermanager-client.jar
   * adobe-utilities.jar（AEM Forms が JBoss Application Server にデプロイされている場合に必要）
   * jbossall-client.jar（AEM Forms が JBoss Application Server にデプロイされている場合に必要）

1. BackupService Client API オブジェクトを作成する

   `ServiceClientFactory` オブジェクトと BackupService クライアント API オブジェクトを一緒に使用します。

   * 接続プロパティを含む `ServiceClientFactory` オブジェクトを作成します。（[接続プロパティの設定](/help/forms/developing/invoking-aem-forms-using-java.md#setting-connection-properties)を参照）
   * コンストラクターを使用して `ServiceClientFactory` オブジェクトを渡すことによって、`BackupService` オブジェクトを作成します。

1. 固有のラベルを決定し、バックアップを実行する時間を決定し、継続的なバックアップモードにするかどうかを決定

   一意のラベルを決定し、バックアップの実行に割り当てる時間を決定し、Forms サーバーを継続的なバックアップモードに保つかどうかを決定します。

1. バックアップモードに入る

   `enterBackupMode` メソッドを次のパラメーターで呼び出してバックアップモードに入ります。

   * バックアップモードセッションを識別する一意の人間が読み取れるラベルを指定する `String` 値。XML 形式にエンコードできないスペースや文字は使用しないことをお勧めします。
   * バックアップモードを維持する時間（分）を指定する `int` 値。`1` から `10080`（1 週間の分数）の値を指定できます。連続バックアップモードを使用する場合、この値は無視されます。
   * 連続バックアップモードにするかどうかを指定する `Boolean` 値。`True` の値は連続バックアップモードにするよう指定します。連続バックアップモードの場合、バックアップモードを維持する分数に指定した値は無視されます。

     連続バックアップモードとは、現在のバックアップモードが完了した後に新しいバックアップモードセッションが開始されることを意味します。 `False` の値は、継続的なバックアップモードが使用されず、バックアップモードを終了した後に、GDS からのファイルのパージが再開されることを意味します。

1. サーバー上のバックアップモードセッションに関する情報を取得する

   `enterBackupMode` メソッドを呼び出した後に返される `BackupModeEntryResult` オブジェクトを使用して情報を取得します。バックアップモードに入った後に取得できる情報は、バックアップ手順との統合に役立つ場合があります。例えば、バックアップ手順のファイル名の入力として、ラベル、バックアップ ID、開始時刻が役立つ場合があります。

1. GDS とデータベースのバックアップを実行

   Forms サーバーが接続されているグローバルドキュメントストレージ（GDS）とデータベースをバックアップします。バックアップを実行するためのアクションは、AEM Forms SDK の一部ではなく、組織内のバックアップ手順に固有の手動手順が含まれる場合もあります。

### Web サービス API を使用してバックアップモードに移行 {#enter-backup-mode-using-the-web-service-api}

バックアップと復元サービス API が提供する web サービスを使用して、バックアップモードに入ります。

1. プロジェクトファイルを含める

   * Backup and Restore Service API WSDL を使用する Microsoft .NET クライアントアセンブリを作成します。
   * Microsoft .NET クライアントアセンブリを参照します。

1. BackupService Client API オブジェクトを作成する

   Microsoft .NET クライアントアセンブリを使用して、デフォルトのコンストラクターを呼び出して `BackupServiceService` オブジェクトを作成し、`Credentials` メソッドを使用して資格情報を指定します。

1. 固有のラベルを決定し、バックアップを実行する時間を決定し、継続的なバックアップモードにするかどうかを決定

   一意のラベルを決定し、バックアップの実行に割り当てる時間を決定し、Forms サーバーを継続的なバックアップモードに保つかどうかを決定します。

1. バックアップモードに入る

   バックアップモードに入るには、enterBackupMode メソッドを呼び出して、次の値を渡します。

   * バックアップモードセッションを識別する一意の人間が読み取れるラベルを指定する `String` 値。XML 形式にエンコードできないスペースや文字は使用しないことをお勧めします。
   * バックアップモードで維持する時間（分）を指定する `Uint32` 値。`1` から `10080`（1 週間の分数）の値を指定できます。連続バックアップモードを使用する場合、この値は無視されます。
   * 連続バックアップモードにするかどうかを指定する `Boolean` 値。`True` の値は連続バックアップモードにするよう指定します。連続バックアップモードの場合、バックアップモードを維持する分数に指定した値は無視されます。連続バックアップモードとは、現在のバックアップモードセッションが完了した後に新しいバックアップモードセッションが開始されることを意味します。

     `False` の値は、継続的なバックアップモードは使用されず、バックアップモードを終了した後に、GDS からのファイルのパージが再開されることを意味します。

1. サーバー上のバックアップモードセッションに関する情報を取得する

   enterBackupMode メソッドを呼び出した後、バックアップモードセッションが成功したことを確認するために返される BackupModeEntryResult からバックアップモードセッションに関する情報を取得します。バックアップモードに入った後に取得できる情報は、バックアップ手順との統合に役立つ場合があります。例えば、バックアップ手順のファイル名の入力として、ラベル、バックアップ ID、開始時刻が役立つ場合があります。

1. GDS とデータベースのバックアップを実行

   Forms サーバーが接続されているグローバルドキュメントストレージ（GDS）とデータベースをバックアップします。バックアップを実行するためのアクションは、AEM Forms SDK の一部ではなく、組織内のバックアップ手順に固有の手動手順が含まれる場合もあります。

## Forms サーバーでのバックアップモードの終了 {#leaving-backup-mode-on-the-forms-server}

バックアップモードを終了して、Forms サーバーで GDS（グローバルドキュメントストレージ）からファイルのパージを再開できるようにします。

終了モードに入るためのアプリケーションを作成する前に、AEM Forms で使用されるバックアップ手順を理解しておくことをお勧めします。AEM Forms のバックアップを実行する際に考慮すべき事項について詳しくは、[管理ヘルプ](https://www.adobe.com/go/learn_aemforms_admin_63_jp)を参照してください。

>[!NOTE]
>
>バックアップおよび復元サービスについて詳しくは、[AEM Forms のサービスリファレンス](https://www.adobe.com/go/learn_aemforms_services_63)を参照してください。

### 手順の概要 {#summary_of_steps-1}

バックアップモードを終了するには、次の手順を実行します。

1. プロジェクトファイルを含めます。
1. BackupService クライアントオブジェクトを作成します。
1. バックアップモードを終了します。
1. （オプション）Forms サーバー上で実行されていたバックアップモードセッションに関する情報を取得します。

**プロジェクトファイルを含める**

開発プロジェクトに必要なファイルをすべて含めます。これらのファイルは、コードを正しくコンパイルし、Backup and Restore Service API を使用する際に重要です。

これらのファイルの場所については、[AEM Forms Java ライブラリファイルを含める](/help/forms/developing/invoking-aem-forms-using-java.md#including-aem-forms-java-library-files)を参照してください。

**BackupService クライアント API オブジェクトを作成**

プログラムでバックアップモードを終了するには、BackupService クライアントオブジェクトを作成して Backup and Restore Service API を使用します。

**バックアップモードの終了**

バックアップモードを終了して、グローバルドキュメントストレージ（GDS）から通常どおりファイルをパージする処理を再開します。バックアップモードを終了する前に、バックアップ手順が完了したことを確認する必要があります。

**終了したバックアップモードセッションに関する情報の取得**

バックアップモードを終了した後、セッションに関する情報を取得できます。この情報は、バックアップ手順との統合に使用できます。

### Java API を使用してバックアップモードを終了する {#leave-backup-mode-using-the-java-api}

Backup and Restore Service API（Java）を使用してバックアップモードを終了します。

1. プロジェクトファイルを含める

   adobe-backup-restore-client-sdk.jar などの必須のクライアント JAR ファイルを Java プロジェクトのクラスパスに含めます。Java クライアントアプリケーションを作成するには、次の JAR ファイルをプロジェクトのクラスパスに追加する必要があります。

   * adobe-backup-restore-client-sdk.jar
   * adobe-livecycle-client.jar
   * adobe-usermanager-client.jar
   * adobe-utilities.jar（AEM Forms が JBoss Application Server にデプロイされている場合に必要）
   * jbossall-client.jar（AEM Forms が JBoss Application Server にデプロイされている場合に必要）

1. BackupService Client API オブジェクトを作成する

   `ServiceClientFactory` オブジェクトと BackupService クライアント API オブジェクトを一緒に使用します。

   * 接続プロパティを含む `ServiceClientFactory` オブジェクトを作成します。（[接続プロパティの設定](/help/forms/developing/invoking-aem-forms-using-java.md#setting-connection-properties)を参照。）
   * コンストラクターを使用し、`ServiceClientFactory` オブジェクトをパラメーターとして渡すことによって、`BackupService` オブジェクトを作成します。

1. バックアップモードに入る

   `leaveBackupMode` メソッドを呼び出して、バックアップモードを終了します。

1. サーバー上のバックアップモードセッションに関する情報を取得する

   返された `BackupModeResult` オブジェクトを使用して、操作に関する情報を取得します。バックアップモードに入った後に取得できる情報は、バックアップ手順との統合に役立つ場合があります。例えば、バックアップ手順のファイル名の入力として、ラベル、バックアップ ID、開始時刻が役立つ場合があります。

### Web サービス API を使用してバックアップモードを終了する {#leave-backup-mode-using-the-web-service-api}

Backup and Restore Service API（web サービス）を使用して、バックアップモードを終了します。

1. プロジェクトファイルを含める

   Web サービスを使用するには、必ずプロキシファイルを含める必要があります。次の手順に従って、Backup and Restore Service API を web サービスとして使用するようにプロジェクトを設定します。

   * Backup and Restore Service API WSDL を使用する Microsoft .NET クライアントアセンブリを作成します。
   * Microsoft .NET クライアントアセンブリを参照します。

1. BackupService Client API オブジェクトを作成する

   Microsoft .NET クライアントアセンブリを使用し、デフォルトのコンストラクターを呼び出して `BackupServiceService` オブジェクトを作成します。

1. バックアップモードに入る

   `leaveBackupMode` web サービス操作を呼び出して、バックアップモードを終了します。

1. サーバー上のバックアップモードセッションに関する情報を取得する

   操作後にバックアップモード識別子を取得し、正常に実行されたことを確認します。バックアップモードを終了した後に取得できる情報は、バックアップ手順との統合に役立つ場合があります。
