---
title: AEM Formsのバックアップの準備
seo-title: AEM Formsのバックアップの準備
description: Java APIとWeb Service APIを使用して、バックアップと復元サービスを使用して、AEM Formsサーバーのバックアップモードを開始および終了する方法を説明します。
seo-description: Java APIとWeb Service APIを使用して、バックアップと復元サービスを使用して、AEM Formsサーバーのバックアップモードを開始および終了する方法を説明します。
uuid: b8ef2bed-62e2-4000-b55a-30d2fc398a5f
contentOwner: admin
content-type: reference
products: SG_EXPERIENCEMANAGER/6.5/FORMS
topic-tags: operations
discoiquuid: e747147e-e96d-43c7-87b3-55947eef81f5
role: Developer
translation-type: tm+mt
source-git-commit: 48726639e93696f32fa368fad2630e6fca50640e
workflow-type: tm+mt
source-wordcount: '2555'
ht-degree: 2%

---


# バックアップ用にAEM Formsを準備中{#preparing-aem-forms-for-backup}

**このドキュメントのサンプルと例は、JEE環境上のAEM Formsに対してのみ提供されています。**

## バックアップと復元サービスについて{#about-the-backup-and-restore-service}

バックアップと復元サービスを使用すると、AEM Formsを&#x200B;*バックアップモード*&#x200B;にすることができます。これにより、ホットバックアップを実行できます。 バックアップと復元サービスは、実際には、AEM Formsのバックアップを実行したり、システムを復元したりするわけではありません。 その代わりに、サーバを一貫性のある信頼性の高いバックアップのための状態にし、サーバを引き続き実行できるようにします。 グローバルドキュメントストレージ(GDS)とformsサーバーに接続されているデータベースをバックアップするには、必ずバックアップ操作を行ってください。 GDSは、長期間有効なプロセス内で使用されるファイルの保存に使用されるディレクトリです。

バックアップモードは、バックアップ手順の実行中にGDS内のファイルが削除されないようにサーバーが入力する状態です。 代わりに、GDSディレクトリの下にサブディレクトリが作成され、保存バックアップモードの終了後に削除されるファイルの記録が維持されます。 ファイルは、システムの再起動後も存続することを目的としており、数日間、または数年間に及ぶ場合もあります。 これらのファイルは、formsサーバーの全体的な状態の中で重要な部分で、PDFファイル、ポリシー、フォームテンプレートなどが含まれる場合があります。 これらのファイルが失われたり破損したりすると、formsサーバー上のプロセスが不安定になり、データが失われる可能性があります。

スナップショットバックアップを実行するように選択できます。通常は、一定期間バックアップモードに入り、バックアップアクティビティを完了した後でバックアップモードを終了します。 ファイルが不必要に大きくならないように、バックアップモードを終了してGDSからファイルを削除できるようにする必要があります。 バックアップモードを明示的に終了するか、バックアップモードセッションで時間が切れるのを待つことができます。

また、サーバを永続バックアップモードのままにすることもできます。これは、ローリングバックアップや継続的なシステムカバーのバックアップ戦略で一般的です。 ローリングバックアップモードは、システムが常にバックアップモードになり、前のセッションが解放されるとすぐに新しいバックアップモードセッションが開始されることを示します。 連続バックアップモードの場合、2つのバックアップモードセッションの後にファイルがパージされ、参照されなくなります。

Backup and Restoreサービスを使用して、既存のアプリケーションや、formsサーバーに接続されているGDSやデータベースのバックアップを実行するために作成する新しいアプリケーションを追加できます。

>[!NOTE]
>
>AEM Formsの実装の他の側面と同様に、バックアップ/リカバリ戦略は、本番環境で使用する前に、開発またはステージング環境で開発およびテストし、ソリューション全体がデータ損失なく正常に機能することを確認する必要があります。

バックアップと復元サービスを使用して、次のタスクを実行できます。

* バックアップモードに入ります。
* バックアップモードを終了します。

>[!NOTE]
>
>AEM Formsのバックアップを実行する際の考慮事項について詳しくは、[管理ヘルプ](https://www.adobe.com/go/learn_aemforms_admin_63)を参照してください。

>[!NOTE]
>
>バックアップと復元サービスの詳細については、[『AEM Formsのサービスリファレンス](https://www.adobe.com/go/learn_aemforms_services_63)』を参照してください。

## formsサーバーでバックアップモードに入る{#entering-backup-mode-on-the-forms-server}

バックアップモードに切り替え、formsサーバーのホットバックアップを許可します。 バックアップモードに入るとき、組織のバックアップ手順に基づいて次の情報を指定します。

* バックアップ・プロセスに役立つバックアップ・モード・セッションを識別する一意のラベル。
* バックアップ手順が完了するまでの時間。
* 連続バックアップモードにするかどうかを示すフラグ。ローリングバックアップを実行する場合にのみ役立ちます。

バックアップモードにするアプリケーションを記述する前に、formsサーバーをバックアップモードにした後に使用するバックアップ手順を理解しておくことをお勧めします。 AEM Formsのバックアップを実行する際の考慮事項について詳しくは、[管理ヘルプ](https://www.adobe.com/go/learn_aemforms_admin_63)を参照してください。

>[!NOTE]
>
>バックアップと復元サービスの詳細については、[『AEM Formsのサービスリファレンス](https://www.adobe.com/go/learn_aemforms_services_63)』を参照してください。

### 手順{#summary-of-steps}の概要

バックアップモードに入るアプリケーションを作成するには、次の手順を実行します。

1. プロジェクトファイルを含めます。
1. BackupServiceクライアントオブジェクトを作成します。
1. 一意のラベル、バックアップの実行時間、連続バックアップモードにするかどうかを決定します。
1. バックアップモードに入ります。
1. （オプション）サーバー上のバックアップモードセッションに関する情報を取得します。
1. GDS（グローバルデータストア）とデータベースのバックアップを実行します。

**プロジェクトファイルを含める**

開発プロジェクトに必要なファイルを含めます。 コードを正しくコンパイルし、バックアップと復元サービスAPIを使用するために、これらのファイルをプロジェクトに含めることが重要です。

これらのファイルの場所については、[AEM Forms Java ライブラリファイルを含める](/help/forms/developing/invoking-aem-forms-using-java.md#including-aem-forms-java-library-files)を参照してください。

**BackupService Client APIオブジェクトの作成**

プログラムでバックアップモードを終了するには、Backup and Restore Service APIを使用するBackupServiceクライアントオブジェクトを作成します。

**一意のラベルを決定し、バックアップの実行時間を決定し、連続バックアップ・モードにするかどうかを決定**

バックアップモードに入る前に、一意のラベルを決定し、バックアップの実行に割り当てる時間を決定し、formsサーバーをバックアップモードのままにするかどうかを決定する必要があります。 これらの考慮事項は、組織が設定したバックアップ手順と統合する際に重要です。 （[管理ヘルプ](https://www.adobe.com/go/learn_aemforms_admin_63)を参照）。

**バックアップモードの開始**

組織のバックアップ手順に合致するパラメーターを使用して、バックアップモードに入ります。

**サーバー上のバックアップモードセッションに関する情報を取得します**

バックアップモードに入ったら、セッションに関する情報を取得できます。 この情報は、バックアップ・プロシージャとの統合に使用できます。

**GDSとデータベースのバックアップの実行**

バックアップモードに問題なく移行したら、グローバルドキュメントストレージ(GDS)とformsサーバーが接続しているデータベースのバックアップを実行できます。 この手順は、手動でこの手順を実行するか、他のツールを実行してバックアップ手順を実行できるので、組織に固有です。

### Java APIを使用してバックアップモードに入る{#enter-backup-mode-using-the-java-api}

バックアップと復元サービスAPIを使用してバックアップモードに入ります。

1. プロジェクトファイルを含める

   Javaプロジェクトのクラスパスに、adobe-backup-restore-client-sdk.jarなど、必要なクライアントJARファイルを含めます。 Javaクライアントアプリケーションを作成するには、次のJARファイルをプロジェクトのクラスパスに追加する必要があります。

   * adobe-backup-restore-client-sdk.jar
   * adobe-livecycle-client.jar
   * adobe-usermanager-client.jar
   * adobe-utilities.jar(AEM FormsがJBoss Application Serverにデプロイされている場合に必要)
   * jbossall-client.jar(AEM FormsがJBoss Application Serverにデプロイされている場合に必要)

1. BackupService Client APIオブジェクトの作成

   `ServiceClientFactory`オブジェクトとBackupServiceクライアントAPIオブジェクトを一緒に使用します。

   * 接続プロパティを含む `ServiceClientFactory` オブジェクトを作成します。（[接続プロパティの設定](/help/forms/developing/invoking-aem-forms-using-java.md#setting-connection-properties)を参照。）
   * コンストラクターを使用し、`BackupService`オブジェクトを渡して、`ServiceClientFactory`オブジェクトを作成します。

1. 一意のラベルを決定し、バックアップの実行時間を決定し、連続バックアップ・モードにするかどうかを決定

   一意のラベルを決定し、バックアップの実行に割り当てる時間を決定し、formsサーバーを連続バックアップモードにするかどうかを決定します。

1. バックアップモードの開始

   `enterBackupMode`メソッドを呼び出し、次のパラメーターを指定してバックアップモードに入ります。

   * バックアップモードセッションを識別する、人間が読み取り可能な一意のラベルを指定する`String`値。 XML形式にエンコードできないスペースや文字は使用しないことをお勧めします。
   * バックアップモードを維持する時間（分）を指定する`int`値。 `1` ～ `10080`の値（1週間の分数）を指定できます。 連続バックアップモードを使用する場合、この値は無視されます。
   * 連続バックアップモードにするかどうかを指定する`Boolean`値。 `True`の値は、連続バックアップモードであることを指定します。 連続バックアップモードの場合、バックアップモードを維持する時間（分）に指定した値は無視されます。

      連続バックアップモードとは、現在のバックアップモードが完了した後に新しいバックアップモードセッションが開始されることを意味します。 `False`の値は、連続バックアップモードが使用されないことを意味し、バックアップモードを終了すると、GDSからのファイルの削除が再開されます。

1. サーバー上のバックアップモードセッションに関する情報を取得します

   `enterBackupMode`メソッドを呼び出した後に返される`BackupModeEntryResult`オブジェクトを使用して情報を取得します。 バックアップモードに入った後に取得できる情報は、バックアップ手順との統合に役立つ場合があります。 例えば、ラベル、バックアップID、開始時間は、バックアップ手順のファイル名の入力として役立ちます。

1. GDSとデータベースのバックアップの実行

   グローバルドキュメントストレージ(GDS)と、formsサーバーが接続されているデータベースをバックアップします。 バックアップを実行するアクションは、AEM FormsSDKに含まれておらず、組織のバックアップ手順に固有の手動手順が含まれている場合もあります。

### WebサービスAPI {#enter-backup-mode-using-the-web-service-api}を使用してバックアップモードに入る

バックアップと復元サービスAPIが提供するWebサービスを使用して、バックアップモードに入ります。

1. プロジェクトファイルを含める

   * バックアップ/復元サービスAPI WSDLを使用するMicrosoft .NETクライアントアセンブリを作成します。
   * Microsoft .NETクライアントアセンブリを参照します。

1. BackupService Client APIオブジェクトの作成

   Microsoft .NETクライアントアセンブリを使用して、デフォルトのコンストラクターを呼び出して`BackupServiceService`オブジェクトを作成し、`Credentials`メソッドを使用して秘密鍵証明書を指定します。

1. 一意のラベルを決定し、バックアップの実行時間を決定し、連続バックアップ・モードにするかどうかを決定

   一意のラベルを決定し、バックアップの実行に割り当てる時間を決定し、formsサーバーを連続バックアップモードにするかどうかを決定します。

1. バックアップモードの開始

   バックアップモードに入るには、enterBackupModeメソッドを呼び出し、次の値を渡します。

   * バックアップモードセッションを識別する、人間が読み取り可能な一意のラベルを指定する`String`値。 XML形式にエンコードできないスペースや文字は使用しないことをお勧めします。
   * バックアップモードを維持する時間（分）を指定する`Uint32`値。 `1` ～ `10080`の値を指定できます（1週間の分数）。 連続バックアップモードを使用する場合、この値は無視されます。
   * 連続バックアップモードにするかどうかを指定する`Boolean`値。 `True`の値は、連続バックアップモードであることを指定します。 連続バックアップモードの場合、バックアップモードを維持する時間（分）に指定した値は無視されます。 連続バックアップモードとは、現在のバックアップモードが完了した後に新しいバックアップモードセッションが開始されることを意味します。

      `False`の値は、連続バックアップモードが使用されないことを意味し、バックアップモードを終了すると、GDSからのファイルの削除が再開されます。

1. サーバー上のバックアップモードセッションに関する情報を取得します

   enterBackupModeメソッドを呼び出してBackupModeEntryResultから呼び出し、成功したことを確認した後、バックアップモードセッションに関する情報を取得します。 バックアップモードに入った後に取得できる情報は、バックアップ手順との統合に役立つ場合があります。 例えば、ラベル、バックアップID、開始時間は、バックアップ手順のファイル名の入力として役立ちます。

1. GDSとデータベースのバックアップの実行

   グローバルドキュメントストレージ(GDS)と、formsサーバーが接続されているデータベースをバックアップします。 バックアップを実行するアクションは、AEM FormsSDKに含まれておらず、組織のバックアップ手順に固有の手動手順が含まれている場合もあります。

## formsサーバーでのバックアップモードの終了{#leaving-backup-mode-on-the-forms-server}

バックアップモードを終了すると、formsサーバーがformsサーバー上のGDS(グローバルドキュメントストレージ)からのファイルの削除を再開します。

終了モードにするアプリケーションを作成する前に、AEM Formsで使用するバックアップ手順を理解することをお勧めします。 AEM Formsのバックアップを実行する際の考慮事項について詳しくは、[管理ヘルプ](https://www.adobe.com/go/learn_aemforms_admin_63)を参照してください。

>[!NOTE]
>
>バックアップと復元サービスの詳細については、[『AEM Formsのサービスリファレンス](https://www.adobe.com/go/learn_aemforms_services_63)』を参照してください。

### 手順{#summary_of_steps-1}の概要

バックアップモードを終了するには、次の手順を実行します。

1. プロジェクトファイルを含めます。
1. BackupServiceクライアントオブジェクトを作成します。
1. バックアップモードを終了します。
1. （オプション）formsサーバーで実行されていたバックアップモードセッションに関する情報を取得します。

**プロジェクトファイルを含める**

開発プロジェクトに必要なすべてのファイルを含めます。 これらのファイルは、コードを正しくコンパイルし、バックアップと復元サービスAPIを使用する際に重要です。

これらのファイルの場所については、[AEM Forms Java ライブラリファイルを含める](/help/forms/developing/invoking-aem-forms-using-java.md#including-aem-forms-java-library-files)を参照してください。

**BackupService Client APIオブジェクトの作成**

プログラムでバックアップモードを終了するには、Backup and Restore Service APIを使用するBackupServiceクライアントオブジェクトを作成します。

**バックアップモードを終了**

グローバルドキュメントストレージ(GDS)からファイルの通常の削除を再開するには、バックアップモードを終了します。 バックアップモードを終了する前に、バックアップ手順が完了していることを確認する必要があります。

**終了したバックアップモードセッションに関する情報を取得します**

バックアップモードを終了すると、セッションに関する情報を取得できます。 この情報は、バックアップ・プロシージャとの統合に使用できます。

### Java API {#leave-backup-mode-using-the-java-api}を使用してバックアップモードを終了

バックアップと復元サービスAPI(Java)を使用してバックアップモードを終了します。

1. プロジェクトファイルを含める

   Javaプロジェクトのクラスパスに、adobe-backup-restore-client-sdk.jarなど、必要なクライアントJARファイルを含めます。 Javaクライアントアプリケーションを作成するには、次のJARファイルをプロジェクトのクラスパスに追加する必要があります。

   * adobe-backup-restore-client-sdk.jar
   * adobe-livecycle-client.jar
   * adobe-usermanager-client.jar
   * adobe-utilities.jar(AEM FormsがJBoss Application Serverにデプロイされている場合に必要)
   * jbossall-client.jar(AEM FormsがJBoss Application Serverにデプロイされている場合に必要)

1. BackupService Client APIオブジェクトの作成

   `ServiceClientFactory`オブジェクトとBackupServiceクライアントAPIオブジェクトを一緒に使用します。

   * 接続プロパティを含む `ServiceClientFactory` オブジェクトを作成します。（[接続プロパティの設定](/help/forms/developing/invoking-aem-forms-using-java.md#setting-connection-properties)を参照。）
   * コンストラクターを使用し、`BackupService`オブジェクトをパラメーターとして渡して、`ServiceClientFactory`オブジェクトを作成します。

1. バックアップモードの開始

   `leaveBackupMode`メソッドを呼び出して、バックアップモードを終了します。

1. サーバー上のバックアップモードセッションに関する情報を取得します

   返される`BackupModeResult`オブジェクトを使用して、操作に関する情報を取得します。 バックアップモードに入った後に取得できる情報は、バックアップ手順との統合に役立つ場合があります。 例えば、ラベル、バックアップID、開始時間は、バックアップ手順のファイル名の入力として役立ちます。

### WebサービスAPI {#leave-backup-mode-using-the-web-service-api}を使用してバックアップモードを終了

バックアップと復元サービスAPI（Webサービス）を使用して、バックアップモードを終了します。

1. プロジェクトファイルを含める

   Webサービスを使用するには、プロキシファイルが含まれていることを確認する必要があります。 次の手順に従って、Backup and Restore Service APIをWebサービスとして使用するようにプロジェクトを設定します。

   * バックアップ/復元サービスAPI WSDLを使用するMicrosoft .NETクライアントアセンブリを作成します。
   * Microsoft .NETクライアントアセンブリを参照します。

1. BackupService Client APIオブジェクトの作成

   Microsoft .NETクライアントアセンブリを使用して、`BackupServiceService`オブジェクトを作成します。その場合は、デフォルトのコンストラクタを呼び出します。

1. バックアップモードの開始

   `leaveBackupMode` Webサービス操作を呼び出して、バックアップモードを終了します。

1. サーバー上のバックアップモードセッションに関する情報を取得します

   操作後にバックアップモード識別子を取得し、正常に終了したことを確認します。 バックアップモードを終了した後に取得できる情報は、バックアップ手順との統合に役立つ場合があります。

